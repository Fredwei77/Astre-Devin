<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§ç‰ˆæ”¯ä»˜æµ‹è¯?- ä¹ç­®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="mystical-theme.css">
    
    <style>
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-button {
            background: linear-gradient(to right, #ffd700, #ffa500);
            color: #1a237e;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }
        
        .test-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-free {
            background: #64748b;
            color: white;
        }
        
        .status-premium {
            background: linear-gradient(to right, #ffd700, #ffa500);
            color: #1a237e;
        }
        
        .status-professional {
            background: linear-gradient(to right, #9333ea, #c026d3);
            color: white;
        }
        
        .log-entry {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .log-success {
            background: rgba(34, 197, 94, 0.2);
            border-left: 3px solid #22c55e;
            color: #86efac;
        }
        
        .log-error {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
            color: #fca5a5;
        }
        
        .log-info {
            background: rgba(59, 130, 246, 0.2);
            border-left: 3px solid #3b82f6;
            color: #93c5fd;
        }
        
        .log-warning {
            background: rgba(251, 191, 36, 0.2);
            border-left: 3px solid #fbbf24;
            color: #fde047;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-deep-navy via-mystic-purple to-jade-dark min-h-screen text-moon-silver">
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-deep-navy/80 backdrop-blur-md border-b border-mystic-gold/30 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-vial text-mystic-gold text-2xl"></i>
                    <h1 class="text-xl font-bold text-mystic-gold">æ”¯ä»˜ç³»ç»Ÿæµ‹è¯•é¢æ¿</h1>
                </div>
                <div class="flex items-center gap-4">
                    <div id="currentPlanBadge"></div>
                    <button onclick="window.location.href='payment-status-checker.html'" 
                            class="text-moon-silver hover:text-mystic-gold transition-colors">
                        <i class="fas fa-heartbeat mr-2"></i>ç³»ç»ŸçŠ¶æ€?                    </button>
                    <button onclick="window.location.href='index.html'" 
                            class="text-moon-silver hover:text-mystic-gold transition-colors">
                        <i class="fas fa-home mr-2"></i>è¿”å›é¦–é¡µ
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- å½“å‰çŠ¶æ€?-->
        <div class="test-section">
            <h2 class="text-2xl font-bold text-mystic-gold mb-4">
                <i class="fas fa-info-circle mr-2"></i>å½“å‰çŠ¶æ€?            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="text-sm text-moon-silver/70 mb-1">è®¢é˜…è®¡åˆ’</div>
                    <div id="currentPlan" class="text-xl font-bold text-mystic-gold">-</div>
                </div>
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="text-sm text-moon-silver/70 mb-1">AIåŠŸèƒ½çŠ¶æ€?/div>
                    <div id="aiStatus" class="text-xl font-bold">-</div>
                </div>
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="text-sm text-moon-silver/70 mb-1">ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°</div>
                    <div id="dailyUsage" class="text-xl font-bold text-mystic-gold">-</div>
                </div>
            </div>
        </div>

        <!-- è®¢é˜…æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-2xl font-bold text-mystic-gold mb-4">
                <i class="fas fa-crown mr-2"></i>è®¢é˜…æµ‹è¯•
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white/5 rounded-lg p-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">ğŸ’</div>
                        <h3 class="text-xl font-bold text-mystic-gold mb-2">Premium é«˜çº§ç‰?/h3>
                        <div class="text-3xl font-bold text-mystic-gold mb-2">$19.99<span class="text-sm">/æœ?/span></div>
                    </div>
                    <ul class="text-sm space-y-2 mb-4">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>å®Œæ•´AIåˆ†æåŠŸèƒ½</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>æ— é™æ¬¡æ•°ä½¿ç”¨</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>ä¸“å®¶å’¨è¯¢ (2æ¬?æœ?</li>
                    </ul>
                    <button onclick="testSubscription('premium')" class="test-button w-full">
                        <i class="fas fa-flask mr-2"></i>æµ‹è¯•è®¢é˜…
                    </button>
                </div>
                
                <div class="bg-white/5 rounded-lg p-6">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">ğŸ‘‘</div>
                        <h3 class="text-xl font-bold text-mystic-gold mb-2">Professional ä¸“ä¸šç‰?/h3>
                        <div class="text-3xl font-bold text-mystic-gold mb-2">$49.99<span class="text-sm">/æœ?/span></div>
                    </div>
                    <ul class="text-sm space-y-2 mb-4">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>æ‰€æœ‰é«˜çº§ç‰ˆåŠŸèƒ½</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>APIè®¿é—®æƒé™</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>å®šåˆ¶æŠ¥å‘Š</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>ä¼˜å…ˆæ”¯æŒ</li>
                    </ul>
                    <button onclick="testSubscription('professional')" class="test-button w-full">
                        <i class="fas fa-flask mr-2"></i>æµ‹è¯•è®¢é˜…
                    </button>
                </div>
            </div>
        </div>

        <!-- æŒ‰æ¬¡ä»˜è´¹æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-2xl font-bold text-mystic-gold mb-4">
                <i class="fas fa-coins mr-2"></i>æŒ‰æ¬¡ä»˜è´¹æµ‹è¯•
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white/5 rounded-lg p-6 text-center">
                    <div class="text-4xl mb-3">ğŸ”®</div>
                    <h3 class="font-bold text-lg mb-2">AIå åœ</h3>
                    <div class="text-2xl font-bold text-mystic-gold mb-3">$0.99</div>
                    <button onclick="testPayPerUse('divination')" class="test-button w-full">
                        <i class="fas fa-flask mr-2"></i>æµ‹è¯•æ”¯ä»˜
                    </button>
                </div>
                
                <div class="bg-white/5 rounded-lg p-6 text-center">
                    <div class="text-4xl mb-3">ğŸ </div>
                    <h3 class="font-bold text-lg mb-2">é£æ°´åˆ†æ</h3>
                    <div class="text-2xl font-bold text-mystic-gold mb-3">$1.99</div>
                    <button onclick="testPayPerUse('fengshui')" class="test-button w-full">
                        <i class="fas fa-flask mr-2"></i>æµ‹è¯•æ”¯ä»˜
                    </button>
                </div>
                
                <div class="bg-white/5 rounded-lg p-6 text-center">
                    <div class="text-4xl mb-3">â˜¯ï¸</div>
                    <h3 class="font-bold text-lg mb-2">æ˜“ç»æ™ºæ…§</h3>
                    <div class="text-2xl font-bold text-mystic-gold mb-3">$2.99</div>
                    <button onclick="testPayPerUse('iching')" class="test-button w-full">
                        <i class="fas fa-flask mr-2"></i>æµ‹è¯•æ”¯ä»˜
                    </button>
                </div>
            </div>
        </div>

        <!-- æƒé™æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-2xl font-bold text-mystic-gold mb-4">
                <i class="fas fa-shield-alt mr-2"></i>æƒé™æµ‹è¯•
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <button onclick="testAIAccess()" class="test-button w-full">
                    <i class="fas fa-robot mr-2"></i>æµ‹è¯•AIåŠŸèƒ½è®¿é—®
                </button>
                <button onclick="testDailyLimit()" class="test-button w-full">
                    <i class="fas fa-calendar-check mr-2"></i>æµ‹è¯•æ¯æ—¥é™åˆ¶
                </button>
                <button onclick="testUpgradePrompt()" class="test-button w-full">
                    <i class="fas fa-arrow-up mr-2"></i>æµ‹è¯•å‡çº§æç¤º
                </button>
                <button onclick="testSingleUseCheck()" class="test-button w-full">
                    <i class="fas fa-ticket-alt mr-2"></i>æµ‹è¯•å•æ¬¡ä½¿ç”¨æƒé™
                </button>
            </div>
        </div>

        <!-- çŠ¶æ€ç®¡ç?-->
        <div class="test-section">
            <h2 class="text-2xl font-bold text-mystic-gold mb-4">
                <i class="fas fa-cog mr-2"></i>çŠ¶æ€ç®¡ç?            </h2>
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <button onclick="setPlan('free')" class="test-button w-full">
                    <i class="fas fa-user mr-2"></i>è®¾ä¸ºå…è´¹ç‰?                </button>
                <button onclick="setPlan('premium')" class="test-button w-full">
                    <i class="fas fa-gem mr-2"></i>è®¾ä¸ºé«˜çº§ç‰?                </button>
                <button onclick="setPlan('professional')" class="test-button w-full">
                    <i class="fas fa-crown mr-2"></i>è®¾ä¸ºä¸“ä¸šç‰?                </button>
                <button onclick="resetUsage()" class="test-button w-full">
                    <i class="fas fa-redo mr-2"></i>é‡ç½®ä½¿ç”¨æ¬¡æ•°
                </button>
                <button onclick="clearSingleUse()" class="test-button w-full">
                    <i class="fas fa-trash mr-2"></i>æ¸…é™¤å•æ¬¡æƒé™
                </button>
                <button onclick="clearAllData()" class="test-button w-full bg-red-500 hover:bg-red-600">
                    <i class="fas fa-exclamation-triangle mr-2"></i>æ¸…é™¤æ‰€æœ‰æ•°æ?                </button>
            </div>
            
            <!-- æµ‹è¯•æ¨¡å¼åˆ‡æ¢ -->
            <div class="bg-white/5 rounded-lg p-4 border border-mystic-gold/30">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-semibold text-mystic-gold mb-1">
                            <i class="fas fa-flask mr-2"></i>æµ‹è¯•æ¨¡å¼
                        </div>
                        <div class="text-sm text-moon-silver/70">
                            å¯ç”¨åå°†æ¨¡æ‹Ÿæ”¯ä»˜æµç¨‹ï¼Œæ— éœ€çœŸå®æ”¯ä»˜
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="testModeToggle" class="sr-only peer" onchange="toggleTestMode()">
                        <div class="w-14 h-7 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-mystic-gold/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-mystic-gold"></div>
                    </label>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="test-section">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-mystic-gold">
                    <i class="fas fa-terminal mr-2"></i>æµ‹è¯•æ—¥å¿—
                </h2>
                <button onclick="clearLog()" class="text-sm text-moon-silver hover:text-mystic-gold">
                    <i class="fas fa-eraser mr-2"></i>æ¸…é™¤æ—¥å¿—
                </button>
            </div>
            <div id="testLog" class="bg-black/40 rounded-lg p-4 max-h-96 overflow-y-auto font-mono text-sm">
                <div class="log-info">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…æµ‹è¯?..</div>
            </div>
        </div>

    </div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="supabase-client.js"></script>
    <script src="subscription-manager.js"></script>
    <script src="stripe-client-enhanced.js"></script>
    <script src="payment-ui.js"></script>

    <script>
        // æµ‹è¯•å·¥å…·å‡½æ•°
        const TestUtils = {
            log(message, type = 'info') {
                const logDiv = document.getElementById('testLog');
                const timestamp = new Date().toLocaleTimeString();
                const entry = document.createElement('div');
                entry.className = `log-entry log-${type}`;
                entry.innerHTML = `[${timestamp}] ${message}`;
                logDiv.appendChild(entry);
                logDiv.scrollTop = logDiv.scrollHeight;
                console.log(`[${type.toUpperCase()}] ${message}`);
            },

            success(message) {
                this.log(`âœ?${message}`, 'success');
            },

            error(message) {
                this.log(`â?${message}`, 'error');
            },

            warning(message) {
                this.log(`âš ï¸ ${message}`, 'warning');
            },

            info(message) {
                this.log(`â„¹ï¸ ${message}`, 'info');
            }
        };

        // æ›´æ–°å½“å‰çŠ¶æ€æ˜¾ç¤?        function updateStatus() {
            const manager = window.subscriptionManager;
            const plan = manager.getCurrentPlan();
            const canUseAI = manager.canUseAI();
            const usage = manager.checkDailyUsage();

            // æ›´æ–°è®¡åˆ’æ˜¾ç¤º
            document.getElementById('currentPlan').textContent = plan.toUpperCase();
            
            // æ›´æ–°å¾½ç« 
            const badge = document.getElementById('currentPlanBadge');
            badge.className = `status-badge status-${plan}`;
            badge.textContent = plan.toUpperCase();

            // æ›´æ–°AIçŠ¶æ€?            const aiStatus = document.getElementById('aiStatus');
            aiStatus.textContent = canUseAI ? 'å·²å¯ç”? : 'æœªå¯ç”?;
            aiStatus.className = `text-xl font-bold ${canUseAI ? 'text-green-400' : 'text-red-400'}`;

            // æ›´æ–°ä½¿ç”¨æ¬¡æ•°
            const usageText = usage.limit === -1 ? 'æ— é™åˆ? : `${usage.used}/${usage.limit}`;
            document.getElementById('dailyUsage').textContent = usageText;

            TestUtils.info(`çŠ¶æ€å·²æ›´æ–°: ${plan} | AI: ${canUseAI ? 'å¯ç”¨' : 'ç¦ç”¨'} | ä½¿ç”¨: ${usageText}`);
        }

        // æµ‹è¯•è®¢é˜…
        function testSubscription(planType) {
            TestUtils.info(`å¼€å§‹æµ‹è¯?${planType} è®¢é˜…...`);
            
            // æ¨¡æ‹Ÿè®¢é˜…æµç¨‹
            TestUtils.info('æ˜¾ç¤ºæ”¯ä»˜è¡¨å•...');
            setTimeout(() => {
                TestUtils.success('æ”¯ä»˜è¡¨å•å·²æ˜¾ç¤?);
                TestUtils.info('æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ...');
                
                // æ›´æ–°ç”¨æˆ·è®¡åˆ’
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                user.subscription = planType;
                user.plan = planType;
                localStorage.setItem('user', JSON.stringify(user));
                
                TestUtils.success(`è®¢é˜…æˆåŠŸï¼å·²å‡çº§åˆ?${planType}`);
                updateStatus();
            }, 1000);
            
            // å®é™…è°ƒç”¨æ”¯ä»˜UI
            if (typeof showPaymentForm === 'function') {
                showPaymentForm(planType);
            }
        }

        // æµ‹è¯•æŒ‰æ¬¡ä»˜è´¹
        function testPayPerUse(serviceType) {
            const manager = window.subscriptionManager;
            const payInfo = manager.payPerUse[serviceType];
            
            TestUtils.info(`å¼€å§‹æµ‹è¯?${payInfo.name} æŒ‰æ¬¡ä»˜è´¹...`);
            TestUtils.info(`ä»·æ ¼: $${payInfo.price}`);
            
            // æ˜¾ç¤ºå‡çº§æç¤ºï¼ˆåŒ…å«æŒ‰æ¬¡ä»˜è´¹é€‰é¡¹ï¼?            manager.showUpgradePrompt(payInfo.name, serviceType);
            TestUtils.success('æŒ‰æ¬¡ä»˜è´¹æç¤ºå·²æ˜¾ç¤?);
        }

        // æµ‹è¯•AIè®¿é—®
        function testAIAccess() {
            const manager = window.subscriptionManager;
            const canUse = manager.canUseAI();
            
            TestUtils.info('æµ‹è¯•AIåŠŸèƒ½è®¿é—®æƒé™...');
            
            if (canUse) {
                TestUtils.success('âœ?æœ‰æƒé™ä½¿ç”¨AIåŠŸèƒ½');
            } else {
                TestUtils.warning('â?æ— æƒé™ä½¿ç”¨AIåŠŸèƒ½');
                TestUtils.info('æ˜¾ç¤ºå‡çº§æç¤º...');
                manager.showUpgradePrompt('AIåŠŸèƒ½', 'divination');
            }
        }

        // æµ‹è¯•æ¯æ—¥é™åˆ¶
        function testDailyLimit() {
            const manager = window.subscriptionManager;
            const usage = manager.checkDailyUsage();
            
            TestUtils.info('æµ‹è¯•æ¯æ—¥ä½¿ç”¨é™åˆ¶...');
            TestUtils.info(`å½“å‰è®¡åˆ’: ${manager.getCurrentPlan()}`);
            TestUtils.info(`ä½¿ç”¨æ¬¡æ•°: ${usage.used}/${usage.limit === -1 ? 'æ— é™' : usage.limit}`);
            
            if (usage.allowed) {
                TestUtils.success('âœ?å¯ä»¥ç»§ç»­ä½¿ç”¨');
                TestUtils.info('æ¨¡æ‹Ÿå¢åŠ ä½¿ç”¨æ¬¡æ•°...');
                manager.incrementDailyUsage();
                updateStatus();
            } else {
                TestUtils.warning('â?å·²è¾¾æ¯æ—¥é™åˆ¶');
                manager.showLimitReachedPrompt();
            }
        }

        // æµ‹è¯•å‡çº§æç¤º
        function testUpgradePrompt() {
            TestUtils.info('æ˜¾ç¤ºå‡çº§æç¤º...');
            window.subscriptionManager.showUpgradePrompt('æµ‹è¯•åŠŸèƒ½', 'divination');
            TestUtils.success('å‡çº§æç¤ºå·²æ˜¾ç¤?);
        }

        // æµ‹è¯•å•æ¬¡ä½¿ç”¨æƒé™
        function testSingleUseCheck() {
            const manager = window.subscriptionManager;
            const services = ['divination', 'fengshui', 'iching'];
            
            TestUtils.info('æ£€æŸ¥å•æ¬¡ä½¿ç”¨æƒé™?..');
            
            services.forEach(service => {
                const count = parseInt(localStorage.getItem(`singleUse_${service}`) || '0');
                const payInfo = manager.payPerUse[service];
                TestUtils.info(`${payInfo.name}: ${count} æ¬¡`);
            });
        }

        // è®¾ç½®è®¡åˆ’
        function setPlan(plan) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            user.subscription = plan;
            user.plan = plan;
            localStorage.setItem('user', JSON.stringify(user));
            
            TestUtils.success(`å·²è®¾ç½®ä¸º ${plan} è®¡åˆ’`);
            updateStatus();
        }

        // é‡ç½®ä½¿ç”¨æ¬¡æ•°
        function resetUsage() {
            const today = new Date().toDateString();
            const usageKey = `usage_${today}`;
            localStorage.removeItem(usageKey);
            
            TestUtils.success('ä½¿ç”¨æ¬¡æ•°å·²é‡ç½?);
            updateStatus();
        }

        // æ¸…é™¤å•æ¬¡ä½¿ç”¨æƒé™
        function clearSingleUse() {
            localStorage.removeItem('singleUse_divination');
            localStorage.removeItem('singleUse_fengshui');
            localStorage.removeItem('singleUse_iching');
            
            TestUtils.success('å•æ¬¡ä½¿ç”¨æƒé™å·²æ¸…é™?);
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ?        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼?)) {
                // æ¸…é™¤è®¢é˜…ä¿¡æ¯
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                user.subscription = 'free';
                user.plan = 'free';
                localStorage.setItem('user', JSON.stringify(user));
                
                // æ¸…é™¤ä½¿ç”¨æ¬¡æ•°
                const today = new Date().toDateString();
                localStorage.removeItem(`usage_${today}`);
                
                // æ¸…é™¤å•æ¬¡ä½¿ç”¨æƒé™
                localStorage.removeItem('singleUse_divination');
                localStorage.removeItem('singleUse_fengshui');
                localStorage.removeItem('singleUse_iching');
                
                TestUtils.success('æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
                updateStatus();
            }
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            const logDiv = document.getElementById('testLog');
            logDiv.innerHTML = '<div class="log-info">æ—¥å¿—å·²æ¸…é™?/div>';
        }

        // åˆ‡æ¢æµ‹è¯•æ¨¡å¼
        function toggleTestMode() {
            const checkbox = document.getElementById('testModeToggle');
            const enabled = checkbox.checked;
            
            if (window.EnhancedStripePaymentService) {
                window.EnhancedStripePaymentService.setTestMode(enabled);
                TestUtils.success(`æµ‹è¯•æ¨¡å¼å·?{enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            TestUtils.success('æµ‹è¯•é¢æ¿å·²åŠ è½?);
            updateStatus();
            
            // æ£€æŸ¥ä¾èµ?            if (typeof window.subscriptionManager === 'undefined') {
                TestUtils.error('subscription-manager.js æœªåŠ è½?);
            } else {
                TestUtils.success('subscription-manager.js å·²åŠ è½?);
            }
            
            if (typeof Stripe === 'undefined') {
                TestUtils.warning('Stripe.js æœªåŠ è½½ï¼ˆå°†ä½¿ç”¨æµ‹è¯•æ¨¡å¼ï¼‰');
            } else {
                TestUtils.success('Stripe.js å·²åŠ è½?);
            }
            
            if (typeof window.EnhancedStripePaymentService === 'undefined') {
                TestUtils.error('stripe-client-enhanced.js æœªåŠ è½?);
            } else {
                TestUtils.success('stripe-client-enhanced.js å·²åŠ è½?);
                
                // è®¾ç½®æµ‹è¯•æ¨¡å¼å¼€å…³çŠ¶æ€?                const isTest = window.EnhancedStripePaymentService.isTestMode();
                document.getElementById('testModeToggle').checked = isTest;
                if (isTest) {
                    TestUtils.info('å½“å‰è¿è¡Œåœ¨æµ‹è¯•æ¨¡å¼?);
                }
            }
        });
    </script>

</body>
</html>
