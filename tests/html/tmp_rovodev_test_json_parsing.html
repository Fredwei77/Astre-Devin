<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONè§£æä¿®å¤æµ‹è¯• - Destiny AI</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: white;
            min-height: 100vh;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .success { background: rgba(76, 175, 80, 0.2); border-color: #4caf50; }
        .error { background: rgba(244, 67, 54, 0.2); border-color: #f44336; }
        .loading { background: rgba(255, 193, 7, 0.2); border-color: #ffc107; }
        
        button {
            background: linear-gradient(45deg, #ffd700, #ff8f00);
            color: #1a237e;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .test-case {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ffd700;
        }
        
        .test-input {
            background: rgba(0, 0, 0, 0.5);
            color: #ffd700;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .test-result {
            background: rgba(0, 0, 0, 0.5);
            color: #90ee90;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        h1, h2 {
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.pass { background: #4caf50; }
        .status.fail { background: #f44336; }
    </style>
</head>
<body>
    <h1>ğŸ”§ JSONè§£æä¿®å¤æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-container">
        <h2>ä¿®å¤æ•ˆæœéªŒè¯</h2>
        <p>è¿™ä¸ªå·¥å…·æµ‹è¯•å„ç§å¯èƒ½çš„AIå“åº”æ ¼å¼ï¼ŒéªŒè¯JSONè§£æä¿®å¤æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
        <button onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
    </div>
    
    <div id="testResults"></div>

    <script src="tmp_rovodev_json_parser.js"></script>
    <script>
        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                name: "æ ‡å‡†JSON",
                input: '{"personality": ["test1"], "elements": {"wood": 70}}',
                shouldPass: true
            },
            {
                name: "å¸¦Markdownæ ‡è®°çš„JSON",
                input: '```json\n{"personality": ["test1"], "elements": {"wood": 70}}\n```',
                shouldPass: true
            },
            {
                name: "å¸¦å‰ç¼€è¯´æ˜çš„JSON",
                input: 'Here is the analysis result:\n```json\n{"personality": ["test1"], "elements": {"wood": 70}}\n```',
                shouldPass: true
            },
            {
                name: "æ··åˆæ ¼å¼JSON",
                input: 'ä»¥ä¸‹æ˜¯åˆ†æç»“æœï¼š\n\n```json\n{\n  "personality": ["åˆ›æ–°æ€ç»´", "é¢†å¯¼èƒ½åŠ›"],\n  "career": ["é€‚åˆç®¡ç†å²—ä½"],\n  "elements": {\n    "wood": 75,\n    "fire": 60\n  }\n}\n```\n\nå¸Œæœ›å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚',
                shouldPass: true
            },
            {
                name: "å¸¦æ³¨é‡Šçš„JSON",
                input: '{\n  // æ€§æ ¼ç‰¹å¾\n  "personality": ["test1"],\n  "elements": {"wood": 70}\n}',
                shouldPass: true
            },
            {
                name: "æ™ºèƒ½å¼•å·JSON",
                input: '{"personality": ["test1"], "elements": {"wood": 70}}',
                shouldPass: true
            },
            {
                name: "å¸¦å°¾éšé€—å·çš„JSON",
                input: '{"personality": ["test1",], "elements": {"wood": 70,}}',
                shouldPass: true
            },
            {
                name: "å¤æ‚åµŒå¥—JSON",
                input: '```json\n{\n  "personality": [\n    "å…·æœ‰æ•é”çš„æ´å¯ŸåŠ›å’Œå¼ºçƒˆçš„ç›´è§‰æ„ŸçŸ¥èƒ½åŠ›",\n    "å¤©ç”Ÿå…·å¤‡é¢†å¯¼æ‰èƒ½ï¼Œå–„äºæ¿€åŠ±ä»–äººè¿½éšæ‚¨çš„æ„¿æ™¯"\n  ],\n  "career": [\n    "åœ¨åˆ›æ„è®¾è®¡ã€è‰ºæœ¯è¡¨è¾¾ç›¸å…³é¢†åŸŸå°†æœ‰çªå‡ºè¡¨ç°",\n    "é€‚åˆä»äº‹éœ€è¦äººé™…æ²Ÿé€šå’Œå›¢é˜Ÿåä½œçš„å·¥ä½œ"\n  ],\n  "elements": {\n    "wood": 78,\n    "fire": 52,\n    "earth": 85,\n    "metal": 63,\n    "water": 41\n  },\n  "luckyColors": ["gold", "green", "purple"],\n  "luckyNumbers": [3, 8, 15]\n}\n```',
                shouldPass: true
            },
            {
                name: "å®Œå…¨é”™è¯¯çš„æ ¼å¼",
                input: 'This is not JSON at all, just plain text.',
                shouldPass: false
            },
            {
                name: "ç©ºå†…å®¹",
                input: '',
                shouldPass: false
            }
        ];
        
        let testResults = [];
        
        async function runAllTests() {
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰JSONè§£ææµ‹è¯•...');
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="test-container loading"><h3>æ­£åœ¨è¿è¡Œæµ‹è¯•...</h3></div>';
            
            testResults = [];
            
            for (let i = 0; i < testCases.length; i++) {
                const testCase = testCases[i];
                console.log(`\nğŸ“ æµ‹è¯• ${i + 1}: ${testCase.name}`);
                
                try {
                    const startTime = Date.now();
                    const result = EnhancedJSONParser.parseAIResponse(testCase.input);
                    const endTime = Date.now();
                    
                    const testResult = {
                        name: testCase.name,
                        input: testCase.input,
                        output: result,
                        success: true,
                        duration: endTime - startTime,
                        shouldPass: testCase.shouldPass,
                        actualPass: true
                    };
                    
                    testResults.push(testResult);
                    console.log(`âœ… æµ‹è¯•é€šè¿‡ï¼Œè€—æ—¶: ${testResult.duration}ms`);
                    
                } catch (error) {
                    const testResult = {
                        name: testCase.name,
                        input: testCase.input,
                        error: error.message,
                        success: false,
                        shouldPass: testCase.shouldPass,
                        actualPass: false
                    };
                    
                    testResults.push(testResult);
                    console.log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                }
                
                // æ·»åŠ å°å»¶è¿Ÿä»¥ä¾¿è§‚å¯Ÿè¿›åº¦
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            displayResults();
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('testResults');
            
            let html = '';
            let passCount = 0;
            let expectedPassCount = 0;
            
            testResults.forEach((result, index) => {
                const isCorrect = result.shouldPass === result.actualPass;
                if (isCorrect) passCount++;
                if (result.shouldPass) expectedPassCount++;
                
                const statusClass = isCorrect ? 'success' : 'error';
                const statusText = isCorrect ? 
                    (result.actualPass ? 'âœ… æ­£ç¡®é€šè¿‡' : 'âœ… æ­£ç¡®å¤±è´¥') : 
                    (result.actualPass ? 'âŒ æ„å¤–é€šè¿‡' : 'âŒ æ„å¤–å¤±è´¥');
                
                html += `
                    <div class="test-container ${statusClass}">
                        <h3>æµ‹è¯• ${index + 1}: ${result.name} <span class="status ${isCorrect ? 'pass' : 'fail'}">${statusText}</span></h3>
                        
                        <strong>è¾“å…¥å†…å®¹:</strong>
                        <div class="test-input">${escapeHtml(result.input.substring(0, 500))}${result.input.length > 500 ? '...' : ''}</div>
                        
                        ${result.success ? `
                            <strong>è§£æç»“æœ:</strong>
                            <div class="test-result">${escapeHtml(JSON.stringify(result.output, null, 2).substring(0, 1000))}${JSON.stringify(result.output).length > 1000 ? '\n...' : ''}</div>
                            <p><strong>è€—æ—¶:</strong> ${result.duration}ms</p>
                        ` : `
                            <strong>é”™è¯¯ä¿¡æ¯:</strong>
                            <div class="test-result">${escapeHtml(result.error)}</div>
                        `}
                    </div>
                `;
            });
            
            // æ·»åŠ æ€»ç»“
            const overallSuccess = passCount === testResults.length;
            const summaryClass = overallSuccess ? 'success' : 
                                passCount > testResults.length / 2 ? 'loading' : 'error';
            
            html = `
                <div class="test-container ${summaryClass}">
                    <h2>æµ‹è¯•æ€»ç»“</h2>
                    <p><strong>æ€»ä½“ç»“æœ:</strong> ${passCount}/${testResults.length} é¡¹æµ‹è¯•ç¬¦åˆé¢„æœŸ</p>
                    <p><strong>æˆåŠŸè§£æ:</strong> ${testResults.filter(r => r.actualPass).length} é¡¹</p>
                    <p><strong>é¢„æœŸæˆåŠŸ:</strong> ${expectedPassCount} é¡¹</p>
                    <p><strong>çŠ¶æ€:</strong> ${overallSuccess ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•éƒ½ç¬¦åˆé¢„æœŸï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•ç»“æœå¼‚å¸¸'}</p>
                </div>
            ` + html;
            
            resultsDiv.innerHTML = html;
            
            console.log(`\nğŸ æµ‹è¯•å®Œæˆ! ${passCount}/${testResults.length} é¡¹ç¬¦åˆé¢„æœŸ`);
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
        }
        
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // é¡µé¢åŠ è½½åæ˜¾ç¤ºè¯´æ˜
        window.addEventListener('load', () => {
            console.log('ğŸ“¦ JSONè§£ææµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('EnhancedJSONParserå¯ç”¨:', typeof EnhancedJSONParser !== 'undefined');
        });
    </script>
</body>
</html>