<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase è¯Šæ–­å·¥å…·</title>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            margin-top: 0;
            color: #667eea;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-top: 10px;
        }
        .check-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        .check-item.pass {
            background: #d4edda;
        }
        .check-item.fail {
            background: #f8d7da;
        }
        .icon {
            margin-right: 10px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Supabase è¯Šæ–­å·¥å…·</h1>
        <p class="subtitle">æ£€æµ‹å’Œä¿®å¤Supabaseè¿æ¥é—®é¢˜</p>

        <!-- æ­¥éª¤1: æ£€æŸ¥å½“å‰é…ç½® -->
        <div class="section">
            <h2>æ­¥éª¤1: æ£€æŸ¥å½“å‰é…ç½®</h2>
            <button onclick="checkCurrentConfig()">æ£€æŸ¥é…ç½®</button>
            <div id="configResult"></div>
        </div>

        <!-- æ­¥éª¤2: è¾“å…¥æ­£ç¡®çš„å¯†é’¥ -->
        <div class="section">
            <h2>æ­¥éª¤2: æµ‹è¯•æ–°çš„APIå¯†é’¥</h2>
            <p style="color: #666; font-size: 14px;">
                ä»Supabase Dashboardè·å–: Settings â†’ API â†’ Project API keys â†’ anon public
            </p>
            <div class="input-group">
                <label>Project URL:</label>
                <input type="text" id="testUrl" value="https://izkcgqvxecfxqtgxpmaj.supabase.co">
            </div>
            <div class="input-group">
                <label>Anon Key (åº”è¯¥ä»¥ eyJ å¼€å¤´):</label>
                <input type="text" id="testKey" placeholder="ç²˜è´´ä½ çš„anon key">
            </div>
            <button onclick="testNewKey()">æµ‹è¯•å¯†é’¥</button>
            <div id="testResult"></div>
        </div>

        <!-- æ­¥éª¤3: ç”Ÿæˆæ›´æ–°ä»£ç  -->
        <div class="section">
            <h2>æ­¥éª¤3: ç”Ÿæˆæ›´æ–°ä»£ç </h2>
            <p style="color: #666; font-size: 14px;">
                å¦‚æœæµ‹è¯•æˆåŠŸï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”Ÿæˆéœ€è¦æ›´æ–°çš„ä»£ç 
            </p>
            <button onclick="generateUpdateCode()">ç”Ÿæˆæ›´æ–°ä»£ç </button>
            <div id="updateCode"></div>
        </div>

        <!-- æ­¥éª¤4: å¸¸è§é—®é¢˜ -->
        <div class="section">
            <h2>å¸¸è§é—®é¢˜</h2>
            <div class="check-item info">
                <span class="icon">ğŸ’¡</span>
                <div>
                    <strong>å¯†é’¥æ ¼å¼é”™è¯¯</strong><br>
                    æ­£ç¡®çš„anon keyåº”è¯¥ä»¥ <code>eyJ</code> å¼€å¤´ï¼Œé•¿åº¦çº¦200-300å­—ç¬¦
                </div>
            </div>
            <div class="check-item info">
                <span class="icon">ğŸ’¡</span>
                <div>
                    <strong>é¡¹ç›®å·²æš‚åœ</strong><br>
                    å…è´¹è®¡åˆ’é•¿æœŸä¸ç”¨ä¼šæš‚åœï¼Œéœ€è¦åœ¨Dashboardä¸­é‡æ–°æ¿€æ´»
                </div>
            </div>
            <div class="check-item info">
                <span class="icon">ğŸ’¡</span>
                <div>
                    <strong>ä½¿ç”¨äº†service_role key</strong><br>
                    å‰ç«¯åªèƒ½ä½¿ç”¨anon keyï¼Œä¸èƒ½ä½¿ç”¨service_role key
                </div>
            </div>
        </div>
    </div>

    <script>
        let validatedUrl = '';
        let validatedKey = '';

        function checkCurrentConfig() {
            const result = document.getElementById('configResult');
            result.innerHTML = '<div class="result info">æ­£åœ¨æ£€æŸ¥...</div>';

            setTimeout(() => {
                let html = '<div class="result">';
                let hasIssues = false;

                // æ£€æŸ¥Supabaseåº“
                if (typeof supabase !== 'undefined') {
                    html += '<div class="check-item pass"><span class="icon">âœ…</span> Supabaseåº“å·²åŠ è½½</div>';
                } else {
                    html += '<div class="check-item fail"><span class="icon">âŒ</span> Supabaseåº“æœªåŠ è½½</div>';
                    hasIssues = true;
                }

                // æ£€æŸ¥é…ç½®æ–‡ä»¶
                if (typeof window.supabaseClient !== 'undefined') {
                    html += '<div class="check-item pass"><span class="icon">âœ…</span> å®¢æˆ·ç«¯å·²åˆå§‹åŒ–</div>';
                } else {
                    html += '<div class="check-item fail"><span class="icon">âŒ</span> å®¢æˆ·ç«¯æœªåˆå§‹åŒ–</div>';
                    hasIssues = true;
                }

                html += '</div>';

                if (hasIssues) {
                    html += '<div class="result warning" style="margin-top: 10px;">âš ï¸ å‘ç°é…ç½®é—®é¢˜ï¼Œè¯·ç»§ç»­ä¸‹ä¸€æ­¥æµ‹è¯•</div>';
                } else {
                    html += '<div class="result success" style="margin-top: 10px;">âœ… åŸºç¡€é…ç½®æ­£å¸¸ï¼Œä½†å¯èƒ½å¯†é’¥æœ‰è¯¯</div>';
                }

                result.innerHTML = html;
            }, 500);
        }

        async function testNewKey() {
            const url = document.getElementById('testUrl').value.trim();
            const key = document.getElementById('testKey').value.trim();
            const result = document.getElementById('testResult');

            if (!url || !key) {
                result.innerHTML = '<div class="result error">âŒ è¯·å¡«å†™URLå’Œå¯†é’¥</div>';
                return;
            }

            // æ£€æŸ¥å¯†é’¥æ ¼å¼
            if (!key.startsWith('eyJ')) {
                result.innerHTML = '<div class="result error">âŒ å¯†é’¥æ ¼å¼é”™è¯¯ï¼šåº”è¯¥ä»¥ eyJ å¼€å¤´</div>';
                return;
            }

            if (key.length < 100) {
                result.innerHTML = '<div class="result warning">âš ï¸ å¯†é’¥é•¿åº¦å¯èƒ½ä¸æ­£ç¡®ï¼ˆå¤ªçŸ­ï¼‰</div>';
                return;
            }

            result.innerHTML = '<div class="result info">â³ æ­£åœ¨æµ‹è¯•è¿æ¥...</div>';

            try {
                // åˆ›å»ºæµ‹è¯•å®¢æˆ·ç«¯
                const testClient = supabase.createClient(url, key);

                // æµ‹è¯•è¿æ¥
                const { data, error } = await testClient.auth.getSession();

                if (error) {
                    result.innerHTML = `<div class="result error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                } else {
                    validatedUrl = url;
                    validatedKey = key;
                    result.innerHTML = `
                        <div class="result success">
                            âœ… å¯†é’¥éªŒè¯æˆåŠŸï¼<br>
                            <small>URL: ${url}</small><br>
                            <small>å¯†é’¥å‰ç¼€: ${key.substring(0, 20)}...</small>
                        </div>
                    `;
                }
            } catch (error) {
                result.innerHTML = `<div class="result error">âŒ æµ‹è¯•å‡ºé”™: ${error.message}</div>`;
            }
        }

        function generateUpdateCode() {
            const result = document.getElementById('updateCode');

            if (!validatedUrl || !validatedKey) {
                result.innerHTML = '<div class="result warning">âš ï¸ è¯·å…ˆåœ¨æ­¥éª¤2ä¸­æµ‹è¯•å¹¶éªŒè¯å¯†é’¥</div>';
                return;
            }

            const code = `
<!-- æ›´æ–° .env æ–‡ä»¶ -->
NEXT_PUBLIC_SUPABASE_URL=${validatedUrl}
NEXT_PUBLIC_SUPABASE_ANON_KEY=${validatedKey}

<!-- æˆ–è€…æ›´æ–° supabase-client.js -->
const SUPABASE_URL = '${validatedUrl}';
const SUPABASE_ANON_KEY = '${validatedKey}';

<!-- æˆ–è€…æ›´æ–° supabase-init.js -->
const SUPABASE_CONFIG = {
    url: '${validatedUrl}',
    anonKey: '${validatedKey}'
};
            `.trim();

            result.innerHTML = `
                <div class="result success">
                    âœ… å·²ç”Ÿæˆæ›´æ–°ä»£ç ï¼Œè¯·å¤åˆ¶å¹¶æ›´æ–°ç›¸åº”æ–‡ä»¶ï¼š
                </div>
                <div class="code">${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                <div class="result info" style="margin-top: 10px;">
                    ğŸ“ æ›´æ–°åè¯·åˆ·æ–°é¡µé¢å¹¶é‡æ–°æµ‹è¯•
                </div>
            `;
        }
    </script>
</body>
</html>
