<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å åœåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin: 10px 0;
        }
        button:hover { background: #45a049; }
        .result {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            border-left-color: #f44336;
            color: #f44336;
        }
        .success {
            border-left-color: #4CAF50;
            color: #4CAF50;
        }
        h1 { color: #333; }
        h2 { color: #666; }
    </style>
</head>
<body>
    <h1>ğŸ”® å åœåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="box">
        <h2>æ­¥éª¤ 1: æ£€æŸ¥ç¯å¢ƒ</h2>
        <div id="check" class="result">ç­‰å¾…æ£€æŸ¥...</div>
    </div>
    
    <div class="box">
        <h2>æ­¥éª¤ 2: æµ‹è¯•å åœåŠŸèƒ½</h2>
        <button onclick="testDivination()">æµ‹è¯•å åœ</button>
        <div id="result"></div>
    </div>
    
    <script src="config.js"></script>
    <script src="ai-service.js"></script>
    
    <script>
        // æ£€æŸ¥ç¯å¢ƒ
        function checkEnvironment() {
            const checkDiv = document.getElementById('check');
            let html = '';
            
            // æ£€æŸ¥ CONFIG
            if (typeof CONFIG !== 'undefined') {
                html += '<div class="success">âœ… CONFIG å·²åŠ è½½</div>';
                html += `<div>- Mock Mode: ${CONFIG.FEATURES.MOCK_MODE}</div>`;
                html += `<div>- API Key: ${CONFIG.OPENROUTER_API_KEY ? 'å·²é…ç½®' : 'æœªé…ç½®'}</div>`;
            } else {
                html += '<div class="error">âŒ CONFIG æœªåŠ è½½</div>';
            }
            
            // æ£€æŸ¥ AIService
            if (typeof AIService !== 'undefined') {
                html += '<div class="success">âœ… AIService ç±»å·²åŠ è½½</div>';
            } else {
                html += '<div class="error">âŒ AIService ç±»æœªåŠ è½½</div>';
            }
            
            // æ£€æŸ¥ aiService å®ä¾‹
            if (typeof aiService !== 'undefined') {
                html += '<div class="success">âœ… aiService å®ä¾‹å·²åˆ›å»º</div>';
                html += `<div>- Mock Mode: ${aiService.mockMode}</div>`;
            } else {
                html += '<div class="error">âŒ aiService å®ä¾‹æœªåˆ›å»º</div>';
            }
            
            checkDiv.innerHTML = html;
        }
        
        // æµ‹è¯•å åœåŠŸèƒ½
        async function testDivination() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">æµ‹è¯•ä¸­...</div>';
            
            try {
                // ç¡®ä¿ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼
                CONFIG.FEATURES.MOCK_MODE = true;
                window.aiService = new AIService();
                
                resultDiv.innerHTML += '<div class="result success">âœ… å·²å¯ç”¨æ¨¡æ‹Ÿæ¨¡å¼</div>';
                
                // æµ‹è¯•æ•°æ®
                const testData = {
                    birthDate: '1990-01-01',
                    birthTime: '12:00',
                    birthPlace: 'Beijing',
                    gender: 'male',
                    categories: ['career', 'wealth', 'love']
                };
                
                resultDiv.innerHTML += '<div class="result">æ­£åœ¨è°ƒç”¨ analyzeDivination...</div>';
                resultDiv.innerHTML += `<div class="result">æµ‹è¯•æ•°æ®: ${JSON.stringify(testData, null, 2)}</div>`;
                
                // è°ƒç”¨å åœåˆ†æ
                const result = await aiService.analyzeDivination(testData);
                
                resultDiv.innerHTML += '<div class="result success">âœ… å åœåˆ†ææˆåŠŸï¼</div>';
                
                // æ˜¾ç¤ºç»“æœ
                resultDiv.innerHTML += '<div class="result success"><strong>è¿”å›çš„æ•°æ®ç»“æ„ï¼š</strong></div>';
                resultDiv.innerHTML += `<div class="result">- personality: ${result.personality ? result.personality.length + ' æ¡' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- career: ${result.career ? result.career.length + ' æ¡' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- wealth: ${result.wealth ? result.wealth.length + ' æ¡' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- love: ${result.love ? result.love.length + ' æ¡' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- health: ${result.health ? result.health.length + ' æ¡' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- elements: ${result.elements ? 'Yes' : 'No'}</div>`;
                resultDiv.innerHTML += `<div class="result">- luckyColors: ${result.luckyColors ? result.luckyColors.length + ' ä¸ª' : 'æ— '}</div>`;
                resultDiv.innerHTML += `<div class="result">- luckyNumbers: ${result.luckyNumbers ? result.luckyNumbers.length + ' ä¸ª' : 'æ— '}</div>`;
                
                // æ˜¾ç¤ºè¯¦ç»†å†…å®¹
                resultDiv.innerHTML += '<div class="result success"><strong>è¯¦ç»†å†…å®¹ï¼š</strong></div>';
                
                if (result.personality) {
                    resultDiv.innerHTML += '<div class="result"><strong>æ€§æ ¼ç‰¹ç‚¹ï¼š</strong><br>';
                    result.personality.forEach((item, i) => {
                        resultDiv.innerHTML += `${i + 1}. ${item}<br>`;
                    });
                    resultDiv.innerHTML += '</div>';
                }
                
                if (result.career) {
                    resultDiv.innerHTML += '<div class="result"><strong>äº‹ä¸šå±•æœ›ï¼š</strong><br>';
                    result.career.forEach((item, i) => {
                        resultDiv.innerHTML += `${i + 1}. ${item}<br>`;
                    });
                    resultDiv.innerHTML += '</div>';
                }
                
                if (result.love) {
                    resultDiv.innerHTML += '<div class="result"><strong>æ„Ÿæƒ…å…³ç³»ï¼š</strong><br>';
                    result.love.forEach((item, i) => {
                        resultDiv.innerHTML += `${i + 1}. ${item}<br>`;
                    });
                    resultDiv.innerHTML += '</div>';
                }
                
                if (result.elements) {
                    resultDiv.innerHTML += '<div class="result"><strong>äº”è¡Œå¹³è¡¡ï¼š</strong><br>';
                    resultDiv.innerHTML += `æœ¨: ${result.elements.wood}<br>`;
                    resultDiv.innerHTML += `ç«: ${result.elements.fire}<br>`;
                    resultDiv.innerHTML += `åœŸ: ${result.elements.earth}<br>`;
                    resultDiv.innerHTML += `é‡‘: ${result.elements.metal}<br>`;
                    resultDiv.innerHTML += `æ°´: ${result.elements.water}<br>`;
                    resultDiv.innerHTML += '</div>';
                }
                
                if (result.luckyColors) {
                    resultDiv.innerHTML += `<div class="result"><strong>å¹¸è¿é¢œè‰²ï¼š</strong> ${result.luckyColors.join(', ')}</div>`;
                }
                
                if (result.luckyNumbers) {
                    resultDiv.innerHTML += `<div class="result"><strong>å¹¸è¿æ•°å­—ï¼š</strong> ${result.luckyNumbers.join(', ')}</div>`;
                }
                
                // æ˜¾ç¤ºå®Œæ•´ JSON
                resultDiv.innerHTML += '<div class="result"><strong>å®Œæ•´ JSONï¼š</strong><br>';
                resultDiv.innerHTML += JSON.stringify(result, null, 2);
                resultDiv.innerHTML += '</div>';
                
                resultDiv.innerHTML += '<div class="result success">ğŸ‰ æµ‹è¯•å®Œæˆï¼æ•°æ®æ ¼å¼æ­£ç¡®ï¼</div>';
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="result error">âŒ é”™è¯¯: ${error.message}</div>`;
                resultDiv.innerHTML += `<div class="result error">å †æ ˆ: ${error.stack}</div>`;
                console.error('æµ‹è¯•å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            checkEnvironment();
        });
    </script>
</body>
</html>
