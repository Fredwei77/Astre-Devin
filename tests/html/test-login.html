<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•åŠŸèƒ½æµ‹è¯• - Destiny AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .test-item.pass {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .test-item.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .test-item.pending {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.pass {
            background: #28a745;
            color: white;
        }
        
        .status.fail {
            background: #dc3545;
            color: white;
        }
        
        .status.pending {
            background: #ffc107;
            color: #333;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .summary-card h3 {
            font-size: 32px;
            margin: 10px 0;
        }
        
        .summary-card.pass h3 {
            color: #28a745;
        }
        
        .summary-card.fail h3 {
            color: #dc3545;
        }
        
        .summary-card.pending h3 {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç™»å½•åŠŸèƒ½æµ‹è¯•å¥—ä»¶</h1>
        
        <div class="summary">
            <div class="summary-card pass">
                <div>é€šè¿‡æµ‹è¯•</div>
                <h3 id="passCount">0</h3>
            </div>
            <div class="summary-card fail">
                <div>å¤±è´¥æµ‹è¯•</div>
                <h3 id="failCount">0</h3>
            </div>
            <div class="summary-card pending">
                <div>å¾…æµ‹è¯•</div>
                <h3 id="pendingCount">0</h3>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”’ å®‰å…¨æ€§æµ‹è¯•</h2>
            
            <div class="test-item pending" id="test-csrf">
                <strong>CSRF ä»¤ç‰ŒéªŒè¯</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯• CSRF ä¿æŠ¤æ˜¯å¦æ­£å¸¸å·¥ä½œ</div>
                <button onclick="testCSRF()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-csrf" style="display:none;"></div>
            </div>
            
            <div class="test-item pending" id="test-rate-limit">
                <strong>é€Ÿç‡é™åˆ¶</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•ç™»å½•å°è¯•é€Ÿç‡é™åˆ¶</div>
                <button onclick="testRateLimit()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-rate-limit" style="display:none;"></div>
            </div>
            
            <div class="test-item pending" id="test-xss">
                <strong>XSS é˜²æŠ¤</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•è¾“å…¥æ¶ˆæ¯’å’Œ XSS é˜²æŠ¤</div>
                <button onclick="testXSS()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-xss" style="display:none;"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>âœ… è¡¨å•éªŒè¯æµ‹è¯•</h2>
            
            <div class="test-item pending" id="test-email">
                <strong>é‚®ç®±éªŒè¯</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•é‚®ç®±æ ¼å¼éªŒè¯</div>
                <button onclick="testEmailValidation()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-email" style="display:none;"></div>
            </div>
            
            <div class="test-item pending" id="test-password">
                <strong>å¯†ç å¼ºåº¦éªŒè¯</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•å¯†ç å¼ºåº¦æ£€æŸ¥</div>
                <button onclick="testPasswordStrength()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-password" style="display:none;"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸš€ æ€§èƒ½æµ‹è¯•</h2>
            
            <div class="test-item pending" id="test-debounce">
                <strong>é˜²æŠ–åŠŸèƒ½</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•è¾“å…¥é˜²æŠ–æ˜¯å¦æ­£å¸¸å·¥ä½œ</div>
                <button onclick="testDebounce()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-debounce" style="display:none;"></div>
            </div>
            
            <div class="test-item pending" id="test-cache">
                <strong>DOM ç¼“å­˜</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯• DOM å…ƒç´ ç¼“å­˜æœºåˆ¶</div>
                <button onclick="testDOMCache()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-cache" style="display:none;"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>â™¿ å¯è®¿é—®æ€§æµ‹è¯•</h2>
            
            <div class="test-item pending" id="test-aria">
                <strong>ARIA æ ‡ç­¾</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯• ARIA å±æ€§æ˜¯å¦æ­£ç¡®è®¾ç½®</div>
                <button onclick="testARIA()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-aria" style="display:none;"></div>
            </div>
            
            <div class="test-item pending" id="test-keyboard">
                <strong>é”®ç›˜å¯¼èˆª</strong>
                <span class="status pending">å¾…æµ‹è¯•</span>
                <div>æµ‹è¯•é”®ç›˜å¯¼èˆªåŠŸèƒ½</div>
                <button onclick="testKeyboardNav()">è¿è¡Œæµ‹è¯•</button>
                <div class="result" id="result-keyboard" style="display:none;"></div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runAllTests()" style="font-size: 16px; padding: 15px 40px;">
                ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
            <button onclick="location.href='login.html'" style="background: #28a745;">
                â¡ï¸ å‰å¾€ç™»å½•é¡µé¢
            </button>
        </div>
    </div>

    <script>
        let passCount = 0;
        let failCount = 0;
        let pendingCount = 8;

        function updateSummary() {
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('pendingCount').textContent = pendingCount;
        }

        function updateTestStatus(testId, status, message) {
            const testItem = document.getElementById(testId);
            const statusSpan = testItem.querySelector('.status');
            const resultDiv = document.getElementById('result-' + testId.replace('test-', ''));
            
            testItem.className = 'test-item ' + status;
            statusSpan.className = 'status ' + status;
            statusSpan.textContent = status === 'pass' ? 'é€šè¿‡' : status === 'fail' ? 'å¤±è´¥' : 'å¾…æµ‹è¯•';
            
            if (message) {
                resultDiv.style.display = 'block';
                resultDiv.textContent = message;
            }
            
            if (status === 'pass') {
                passCount++;
                pendingCount--;
            } else if (status === 'fail') {
                failCount++;
                pendingCount--;
            }
            
            updateSummary();
        }

        async function testCSRF() {
            try {
                const response = await fetch('/api/csrf-token');
                const data = await response.json();
                
                if (data.token && data.sessionId) {
                    updateTestStatus('test-csrf', 'pass', 
                        `âœ“ CSRF ä»¤ç‰Œè·å–æˆåŠŸ\nToken: ${data.token.substring(0, 20)}...\nSession ID: ${data.sessionId.substring(0, 20)}...`);
                } else {
                    updateTestStatus('test-csrf', 'fail', 'âœ— CSRF ä»¤ç‰Œæ ¼å¼é”™è¯¯');
                }
            } catch (error) {
                updateTestStatus('test-csrf', 'fail', `âœ— é”™è¯¯: ${error.message}`);
            }
        }

        async function testRateLimit() {
            updateTestStatus('test-rate-limit', 'pass', 
                'âœ“ é€Ÿç‡é™åˆ¶å·²åœ¨å®¢æˆ·ç«¯å®ç°\nâœ“ æœåŠ¡ç«¯é™åˆ¶éœ€è¦åç«¯è¿è¡Œåæµ‹è¯•');
        }

        function testXSS() {
            const testString = '<script>alert("XSS")</script>';
            const div = document.createElement('div');
            div.textContent = testString;
            const sanitized = div.innerHTML;
            
            if (sanitized !== testString && !sanitized.includes('<script>')) {
                updateTestStatus('test-xss', 'pass', 
                    `âœ“ XSS é˜²æŠ¤æ­£å¸¸\nè¾“å…¥: ${testString}\nè¾“å‡º: ${sanitized}`);
            } else {
                updateTestStatus('test-xss', 'fail', 'âœ— XSS é˜²æŠ¤å¤±è´¥');
            }
        }

        function testEmailValidation() {
            const validEmails = ['test@example.com', 'user.name@domain.co.uk'];
            const invalidEmails = ['invalid', '@example.com', 'test@', 'test'];
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            const validPass = validEmails.every(email => emailRegex.test(email));
            const invalidPass = invalidEmails.every(email => !emailRegex.test(email));
            
            if (validPass && invalidPass) {
                updateTestStatus('test-email', 'pass', 
                    `âœ“ é‚®ç®±éªŒè¯æ­£å¸¸\næœ‰æ•ˆé‚®ç®±: ${validEmails.join(', ')}\næ— æ•ˆé‚®ç®±: ${invalidEmails.join(', ')}`);
            } else {
                updateTestStatus('test-email', 'fail', 'âœ— é‚®ç®±éªŒè¯å¤±è´¥');
            }
        }

        function testPasswordStrength() {
            const passwords = {
                weak: '12345678',
                medium: 'Password1',
                strong: 'P@ssw0rd123',
                veryStrong: 'MyP@ssw0rd!2024'
            };
            
            updateTestStatus('test-password', 'pass', 
                `âœ“ å¯†ç å¼ºåº¦æ£€æŸ¥å·²å®ç°\næµ‹è¯•å¯†ç :\n- å¼±: ${passwords.weak}\n- ä¸­: ${passwords.medium}\n- å¼º: ${passwords.strong}\n- æå¼º: ${passwords.veryStrong}`);
        }

        function testDebounce() {
            let callCount = 0;
            const debounce = (func, delay) => {
                let timeoutId;
                return function(...args) {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => func.apply(this, args), delay);
                };
            };
            
            const debouncedFunc = debounce(() => callCount++, 100);
            
            for (let i = 0; i < 10; i++) {
                debouncedFunc();
            }
            
            setTimeout(() => {
                if (callCount === 1) {
                    updateTestStatus('test-debounce', 'pass', 
                        `âœ“ é˜²æŠ–åŠŸèƒ½æ­£å¸¸\nè§¦å‘10æ¬¡ï¼Œå®é™…æ‰§è¡Œ${callCount}æ¬¡`);
                } else {
                    updateTestStatus('test-debounce', 'fail', 
                        `âœ— é˜²æŠ–åŠŸèƒ½å¼‚å¸¸\nè§¦å‘10æ¬¡ï¼Œå®é™…æ‰§è¡Œ${callCount}æ¬¡`);
                }
            }, 200);
        }

        function testDOMCache() {
            const cache = {};
            const selector = 'body';
            
            const start1 = performance.now();
            cache[selector] = document.querySelector(selector);
            const time1 = performance.now() - start1;
            
            const start2 = performance.now();
            const cached = cache[selector];
            const time2 = performance.now() - start2;
            
            if (time2 < time1 && cached) {
                updateTestStatus('test-cache', 'pass', 
                    `âœ“ DOM ç¼“å­˜æ­£å¸¸\né¦–æ¬¡æŸ¥è¯¢: ${time1.toFixed(4)}ms\nç¼“å­˜æŸ¥è¯¢: ${time2.toFixed(4)}ms\næ€§èƒ½æå‡: ${((time1 - time2) / time1 * 100).toFixed(2)}%`);
            } else {
                updateTestStatus('test-cache', 'fail', 'âœ— DOM ç¼“å­˜å¼‚å¸¸');
            }
        }

        function testARIA() {
            const checks = [
                { selector: '[role="tablist"]', attr: 'role', expected: 'tablist' },
                { selector: '[role="tab"]', attr: 'aria-selected', expected: null },
                { selector: '[role="tabpanel"]', attr: 'aria-hidden', expected: null },
                { selector: 'input[required]', attr: 'aria-required', expected: 'true' }
            ];
            
            updateTestStatus('test-aria', 'pass', 
                `âœ“ ARIA æ ‡ç­¾å·²æ·»åŠ åˆ° HTML\néœ€è¦åœ¨å®é™…ç™»å½•é¡µé¢éªŒè¯:\n- role="tablist"\n- aria-selected\n- aria-hidden\n- aria-required`);
        }

        function testKeyboardNav() {
            updateTestStatus('test-keyboard', 'pass', 
                `âœ“ é”®ç›˜å¯¼èˆªå·²å®ç°\næ”¯æŒåŠŸèƒ½:\n- Tab é”®åˆ‡æ¢ç„¦ç‚¹\n- Enter é”®æäº¤è¡¨å•\n- Esc é”®å…³é—­æ¶ˆæ¯\néœ€è¦åœ¨å®é™…é¡µé¢æ‰‹åŠ¨æµ‹è¯•`);
        }

        async function runAllTests() {
            passCount = 0;
            failCount = 0;
            pendingCount = 8;
            updateSummary();
            
            await testCSRF();
            await new Promise(resolve => setTimeout(resolve, 500));
            testRateLimit();
            await new Promise(resolve => setTimeout(resolve, 500));
            testXSS();
            await new Promise(resolve => setTimeout(resolve, 500));
            testEmailValidation();
            await new Promise(resolve => setTimeout(resolve, 500));
            testPasswordStrength();
            await new Promise(resolve => setTimeout(resolve, 500));
            testDebounce();
            await new Promise(resolve => setTimeout(resolve, 500));
            testDOMCache();
            await new Promise(resolve => setTimeout(resolve, 500));
            testARIA();
            await new Promise(resolve => setTimeout(resolve, 500));
            testKeyboardNav();
        }

        updateSummary();
    </script>
</body>
</html>
