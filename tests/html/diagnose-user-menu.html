<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·èœå•è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a237e;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #ffd700;
            text-align: center;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .check-item {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #ffd700;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .success {
            border-left-color: #4caf50;
            color: #4caf50;
        }
        
        .error {
            border-left-color: #f44336;
            color: #f44336;
        }
        
        .warning {
            border-left-color: #ff9800;
            color: #ff9800;
        }
        
        button {
            background: #ffd700;
            color: #1a237e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #daa520;
        }
        
        .code {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç”¨æˆ·èœå•è¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
        <h2>ğŸ“‹ ç³»ç»Ÿæ£€æŸ¥</h2>
        <div id="systemChecks"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ® å¿«é€Ÿæ“ä½œ</h2>
        <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <button onclick="clearLogin()">æ¸…é™¤ç™»å½•</button>
        <button onclick="runDiagnostics()">é‡æ–°è¯Šæ–­</button>
        <button onclick="openConsole()">æ‰“å¼€æ§åˆ¶å°</button>
    </div>
    
    <div class="section">
        <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
        <div id="currentStatus"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ”§ ä¿®å¤å»ºè®®</h2>
        <div id="fixSuggestions"></div>
    </div>

    <script>
        function checkItem(name, condition, successMsg, errorMsg) {
            const div = document.createElement('div');
            div.className = 'check-item ' + (condition ? 'success' : 'error');
            div.innerHTML = `
                <strong>${condition ? 'âœ…' : 'âŒ'} ${name}</strong><br>
                <small>${condition ? successMsg : errorMsg}</small>
            `;
            return div;
        }
        
        function runDiagnostics() {
            const systemChecks = document.getElementById('systemChecks');
            systemChecks.innerHTML = '';
            
            // æ£€æŸ¥æ–‡ä»¶åŠ è½½
            systemChecks.appendChild(checkItem(
                'Font Awesome',
                typeof FontAwesome !== 'undefined' || document.querySelector('link[href*="font-awesome"]'),
                'Font Awesome å·²åŠ è½½',
                'Font Awesome æœªåŠ è½½ - å›¾æ ‡å°†æ— æ³•æ˜¾ç¤º'
            ));
            
            systemChecks.appendChild(checkItem(
                'user-menu.css',
                document.querySelector('link[href*="user-menu.css"]'),
                'user-menu.css å·²åŠ è½½',
                'user-menu.css æœªåŠ è½½ - æ ·å¼å¯èƒ½ä¸æ­£ç¡®'
            ));
            
            systemChecks.appendChild(checkItem(
                'auth-service.js',
                typeof window.AuthService !== 'undefined',
                'AuthService å·²åŠ è½½',
                'AuthService æœªåŠ è½½ - è®¤è¯åŠŸèƒ½å°†æ— æ³•å·¥ä½œ'
            ));
            
            systemChecks.appendChild(checkItem(
                'user-menu.js',
                typeof window.UserMenuManager !== 'undefined',
                'UserMenuManager å·²åŠ è½½',
                'UserMenuManager æœªåŠ è½½ - ç”¨æˆ·èœå•å°†æ— æ³•å·¥ä½œ'
            ));
            
            // æ£€æŸ¥DOMå…ƒç´ 
            systemChecks.appendChild(checkItem(
                'userView å…ƒç´ ',
                document.getElementById('userView'),
                'userView å…ƒç´ å­˜åœ¨',
                'userView å…ƒç´ ä¸å­˜åœ¨ - æ£€æŸ¥HTMLç»“æ„'
            ));
            
            systemChecks.appendChild(checkItem(
                'guestView å…ƒç´ ',
                document.getElementById('guestView'),
                'guestView å…ƒç´ å­˜åœ¨',
                'guestView å…ƒç´ ä¸å­˜åœ¨ - æ£€æŸ¥HTMLç»“æ„'
            ));
            
            systemChecks.appendChild(checkItem(
                'userMenuBtn å…ƒç´ ',
                document.getElementById('userMenuBtn'),
                'userMenuBtn å…ƒç´ å­˜åœ¨',
                'userMenuBtn å…ƒç´ ä¸å­˜åœ¨ - ä¸‹æ‹‰æŒ‰é’®å°†æ— æ³•æ˜¾ç¤º'
            ));
            
            systemChecks.appendChild(checkItem(
                'userMenu å…ƒç´ ',
                document.getElementById('userMenu'),
                'userMenu å…ƒç´ å­˜åœ¨',
                'userMenu å…ƒç´ ä¸å­˜åœ¨ - ä¸‹æ‹‰èœå•å°†æ— æ³•æ˜¾ç¤º'
            ));
            
            // æ›´æ–°å½“å‰çŠ¶æ€
            updateCurrentStatus();
            
            // ç”Ÿæˆä¿®å¤å»ºè®®
            generateFixSuggestions();
        }
        
        function updateCurrentStatus() {
            const statusDiv = document.getElementById('currentStatus');
            const isAuth = window.AuthService ? window.AuthService.isAuthenticated() : false;
            const user = window.AuthService ? window.AuthService.getCurrentUser() : null;
            
            statusDiv.innerHTML = `
                <div class="check-item">
                    <strong>ç™»å½•çŠ¶æ€:</strong> ${isAuth ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}<br>
                    <strong>ç”¨æˆ·å:</strong> ${user ? (user.name || user.email) : '-'}<br>
                    <strong>ç”¨æˆ·é‚®ç®±:</strong> ${user ? user.email : '-'}<br>
                    <strong>Token:</strong> ${window.AuthService ? (window.AuthService.getToken() ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨') : '-'}
                </div>
            `;
        }
        
        function generateFixSuggestions() {
            const suggestionsDiv = document.getElementById('fixSuggestions');
            const suggestions = [];
            
            // æ£€æŸ¥Font Awesome
            if (!document.querySelector('link[href*="font-awesome"]')) {
                suggestions.push({
                    title: 'æ·»åŠ  Font Awesome',
                    description: 'åœ¨ index.html çš„ &lt;head&gt; éƒ¨åˆ†æ·»åŠ ï¼š',
                    code: '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">'
                });
            }
            
            // æ£€æŸ¥user-menu.css
            if (!document.querySelector('link[href*="user-menu.css"]')) {
                suggestions.push({
                    title: 'æ·»åŠ  user-menu.css',
                    description: 'åœ¨ index.html çš„ &lt;head&gt; éƒ¨åˆ†æ·»åŠ ï¼š',
                    code: '<link rel="stylesheet" href="user-menu.css">'
                });
            }
            
            // æ£€æŸ¥auth-service.js
            if (typeof window.AuthService === 'undefined') {
                suggestions.push({
                    title: 'æ·»åŠ  auth-service.js',
                    description: 'åœ¨ index.html çš„ &lt;/body&gt; æ ‡ç­¾å‰æ·»åŠ ï¼š',
                    code: '<script src="auth-service.js"></script>'
                });
            }
            
            // æ£€æŸ¥user-menu.js
            if (typeof window.UserMenuManager === 'undefined') {
                suggestions.push({
                    title: 'æ·»åŠ  user-menu.js',
                    description: 'åœ¨ index.html çš„ &lt;/body&gt; æ ‡ç­¾å‰æ·»åŠ ï¼š',
                    code: '<script src="user-menu.js"></script>'
                });
            }
            
            if (suggestions.length === 0) {
                suggestionsDiv.innerHTML = '<div class="check-item success">âœ… æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡äº†ï¼</div>';
            } else {
                suggestionsDiv.innerHTML = suggestions.map(s => `
                    <div class="check-item warning">
                        <strong>âš ï¸ ${s.title}</strong><br>
                        <small>${s.description}</small><br>
                        <div class="code">${s.code}</div>
                    </div>
                `).join('');
            }
        }
        
        function simulateLogin() {
            const testUser = {
                email: 'test@destinyai.com',
                name: 'Test User',
                id: '12345'
            };
            
            const testToken = 'test_token_' + Date.now();
            
            if (window.AuthService) {
                window.AuthService.setAuth(testToken, testUser, true);
            } else {
                localStorage.setItem('destinyai_token', testToken);
                localStorage.setItem('destinyai_user', JSON.stringify(testUser));
            }
            
            alert('âœ… æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼\n\nè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚');
            runDiagnostics();
        }
        
        function clearLogin() {
            if (window.AuthService) {
                window.AuthService.clearAuth();
            } else {
                localStorage.clear();
                sessionStorage.clear();
            }
            
            alert('âŒ ç™»å½•çŠ¶æ€å·²æ¸…é™¤ï¼\n\nè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚');
            runDiagnostics();
        }
        
        function openConsole() {
            alert('è¯·æŒ‰ F12 æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ã€‚');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œè¯Šæ–­
        window.addEventListener('DOMContentLoaded', runDiagnostics);
    </script>
</body>
</html>
