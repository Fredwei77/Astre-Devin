<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - Destiny AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4ec9b0;
            margin-bottom: 20px;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        .section {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            color: #569cd6;
            margin-bottom: 15px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.ok { background: #4ec9b0; color: #000; }
        .status.error { background: #f48771; color: #000; }
        .status.warning { background: #dcdcaa; color: #000; }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-family: inherit;
        }
        button:hover { background: #1177bb; }
        pre {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .log {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #3e3e42;
        }
        .log-entry.info { color: #4ec9b0; }
        .log-entry.error { color: #f48771; }
        .log-entry.success { color: #89d185; }
        a {
            color: #569cd6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Destiny AI - è°ƒè¯•æ§åˆ¶å°</h1>

        <div class="section">
            <h2>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h2>
            <div id="system-info"></div>
        </div>

        <div class="section">
            <h2>ğŸŒ æœåŠ¡å™¨çŠ¶æ€</h2>
            <button onclick="checkServer()">æ£€æŸ¥æœåŠ¡å™¨</button>
            <button onclick="checkAllEndpoints()">æ£€æŸ¥æ‰€æœ‰ç«¯ç‚¹</button>
            <div id="server-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ“„ é¡µé¢æµ‹è¯•</h2>
            <button onclick="testPage('login.html')">æµ‹è¯• login.html</button>
            <button onclick="testPage('test-login.html')">æµ‹è¯• test-login.html</button>
            <button onclick="testPage('test-simple.html')">æµ‹è¯• test-simple.html</button>
            <button onclick="testPage('index.html')">æµ‹è¯• index.html</button>
            <div id="page-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ” API æµ‹è¯•</h2>
            <button onclick="testAPI('health')">å¥åº·æ£€æŸ¥</button>
            <button onclick="testAPI('csrf')">CSRFä»¤ç‰Œ</button>
            <button onclick="testAPI('login')">ç™»å½•æµ‹è¯•</button>
            <button onclick="testAPI('register')">æ³¨å†Œæµ‹è¯•</button>
            <div id="api-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ“ æ§åˆ¶å°æ—¥å¿—</h2>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            <div id="console-log" class="log"></div>
        </div>

        <div class="section">
            <h2>ğŸ”— å¿«é€Ÿé“¾æ¥</h2>
            <p>
                <a href="/login.html" target="_blank">ç™»å½•é¡µé¢</a> |
                <a href="/test-login.html" target="_blank">æµ‹è¯•é¡µé¢</a> |
                <a href="/test-simple.html" target="_blank">ç®€å•æµ‹è¯•</a> |
                <a href="/index.html" target="_blank">é¦–é¡µ</a>
            </p>
        </div>
    </div>

    <script>
        const log = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            log.push({ timestamp, message, type });
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logDiv = document.getElementById('console-log');
            logDiv.innerHTML = log.map(entry => 
                `<div class="log-entry ${entry.type}">[${entry.timestamp}] ${entry.type.toUpperCase()}: ${entry.message}</div>`
            ).reverse().join('');
        }

        function clearLog() {
            log.length = 0;
            updateLogDisplay();
        }

        // ç³»ç»Ÿä¿¡æ¯
        document.getElementById('system-info').innerHTML = `
            <pre>User Agent: ${navigator.userAgent}
Platform: ${navigator.platform}
Language: ${navigator.language}
Online: ${navigator.onLine}
Cookie Enabled: ${navigator.cookieEnabled}
Current URL: ${window.location.href}
Protocol: ${window.location.protocol}
Host: ${window.location.host}</pre>
        `;

        async function checkServer() {
            const statusDiv = document.getElementById('server-status');
            statusDiv.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨...</p>';
            addLog('å¼€å§‹æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€');

            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                statusDiv.innerHTML = `
                    <div style="color: #89d185;">
                        <p><strong>âœ“ æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ</strong> <span class="status ok">OK</span></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                addLog('æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥æˆåŠŸ', 'success');
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="color: #f48771;">
                        <p><strong>âœ— æœåŠ¡å™¨è¿æ¥å¤±è´¥</strong> <span class="status error">ERROR</span></p>
                        <pre>${error.message}</pre>
                    </div>
                `;
                addLog(`æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function checkAllEndpoints() {
            const endpoints = [
                '/api/health',
                '/api/csrf-token',
                '/login.html',
                '/test-login.html',
                '/test-simple.html'
            ];

            const statusDiv = document.getElementById('server-status');
            statusDiv.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥æ‰€æœ‰ç«¯ç‚¹...</p>';
            addLog('å¼€å§‹æ£€æŸ¥æ‰€æœ‰ç«¯ç‚¹');

            const results = [];
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    results.push({
                        endpoint,
                        status: response.status,
                        ok: response.ok
                    });
                    addLog(`${endpoint}: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    results.push({
                        endpoint,
                        status: 'ERROR',
                        ok: false,
                        error: error.message
                    });
                    addLog(`${endpoint}: ${error.message}`, 'error');
                }
            }

            statusDiv.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="border-bottom: 1px solid #3e3e42;">
                        <th style="text-align: left; padding: 8px;">ç«¯ç‚¹</th>
                        <th style="text-align: left; padding: 8px;">çŠ¶æ€</th>
                    </tr>
                    ${results.map(r => `
                        <tr style="border-bottom: 1px solid #3e3e42;">
                            <td style="padding: 8px;">${r.endpoint}</td>
                            <td style="padding: 8px;">
                                <span class="status ${r.ok ? 'ok' : 'error'}">${r.status}</span>
                                ${r.error ? `<br><small>${r.error}</small>` : ''}
                            </td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }

        async function testPage(page) {
            const statusDiv = document.getElementById('page-status');
            statusDiv.innerHTML = `<p>æ­£åœ¨æµ‹è¯• ${page}...</p>`;
            addLog(`å¼€å§‹æµ‹è¯•é¡µé¢: ${page}`);

            try {
                const response = await fetch(`/${page}`);
                const text = await response.text();
                
                statusDiv.innerHTML = `
                    <div style="color: #89d185;">
                        <p><strong>âœ“ ${page}</strong> <span class="status ok">${response.status}</span></p>
                        <p>å¤§å°: ${text.length} å­—èŠ‚</p>
                        <p>ç±»å‹: ${response.headers.get('content-type')}</p>
                        <button onclick="window.open('/${page}', '_blank')">åœ¨æ–°çª—å£æ‰“å¼€</button>
                    </div>
                `;
                addLog(`${page} æµ‹è¯•æˆåŠŸ (${response.status})`, 'success');
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="color: #f48771;">
                        <p><strong>âœ— ${page}</strong> <span class="status error">ERROR</span></p>
                        <pre>${error.message}</pre>
                    </div>
                `;
                addLog(`${page} æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAPI(type) {
            const statusDiv = document.getElementById('api-status');
            statusDiv.innerHTML = `<p>æ­£åœ¨æµ‹è¯• ${type} API...</p>`;
            addLog(`å¼€å§‹æµ‹è¯• ${type} API`);

            try {
                let response, data;

                switch(type) {
                    case 'health':
                        response = await fetch('/api/health');
                        data = await response.json();
                        break;
                    
                    case 'csrf':
                        response = await fetch('/api/csrf-token');
                        data = await response.json();
                        break;
                    
                    case 'login':
                        response = await fetch('/api/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: 'test@example.com',
                                password: 'password123'
                            })
                        });
                        data = await response.json();
                        break;
                    
                    case 'register':
                        response = await fetch('/api/auth/register', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: 'Test User',
                                email: 'newuser@example.com',
                                password: 'Password123'
                            })
                        });
                        data = await response.json();
                        break;
                }

                statusDiv.innerHTML = `
                    <div style="color: #89d185;">
                        <p><strong>âœ“ ${type} API</strong> <span class="status ok">${response.status}</span></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
                addLog(`${type} API æµ‹è¯•æˆåŠŸ`, 'success');
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="color: #f48771;">
                        <p><strong>âœ— ${type} API</strong> <span class="status error">ERROR</span></p>
                        <pre>${error.message}</pre>
                    </div>
                `;
                addLog(`${type} API æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            addLog('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            checkServer();
        });

        // æ•è·æ‰€æœ‰é”™è¯¯
        window.addEventListener('error', (e) => {
            addLog(`å…¨å±€é”™è¯¯: ${e.message}`, 'error');
        });

        // æ•è·æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', (e) => {
            addLog(`æœªå¤„ç†çš„Promiseæ‹’ç»: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>
