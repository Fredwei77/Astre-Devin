# 占卜追问功能说明

## 功能概述

在占卜结果页面下方新增了AI追问对话框，用户可以针对占卜结果进行深度追问，获取更详细的解答。

## 主要特性

### 1. 智能建议问题
- 根据用户选择的占卜类别（事业、财运、爱情、健康）自动生成相关的建议追问
- 点击建议问题可快速填入输入框

### 2. 类别对应的建议问题

**事业类**
- 如何提升我的事业运势？
- 什么时候是换工作的最佳时机？
- 我适合创业吗？
- 如何改善与上司的关系？

**财运类**
- 如何增加我的财富运？
- 投资理财有什么建议？
- 什么时候是财运最旺的时期？
- 如何避免破财？

**爱情类**
- 如何改善我的感情运势？
- 什么时候会遇到真命天子/天女？
- 如何化解感情中的矛盾？
- 我和伴侣是否合适？

**健康类**
- 如何改善我的健康状况？
- 需要注意哪些健康问题？
- 什么养生方法最适合我？
- 如何提升精气神？

### 3. AI智能解答
- 基于用户的占卜结果和出生信息提供个性化解答
- 结合东方命理智慧给出专业建议
- 包含具体分析、改善方法、时机建议和实际操作指南

### 4. 用户体验优化
- 支持Ctrl+Enter快捷键提交问题
- 加载状态提示
- 答案自动滚动到可视区域
- 关键词高亮显示

## 技术实现

### 文件结构
```
divination.html          - 页面HTML结构
divination-followup.js   - 追问功能核心逻辑
main.js                  - 集成追问功能初始化
translations.js          - 多语言翻译支持
ai-service.js           - AI服务调用
```

### 核心功能

1. **generateSuggestedQuestions()** - 根据类别生成建议问题
2. **renderSuggestedQuestions()** - 渲染建议问题按钮
3. **handleFollowupQuestion()** - 处理用户追问请求
4. **buildFollowupContext()** - 构建AI对话上下文
5. **formatAnswer()** - 格式化AI答案显示

### 数据流程

```
用户完成占卜
    ↓
显示占卜结果
    ↓
初始化追问功能 (DivinationFollowup.init)
    ↓
生成建议问题
    ↓
用户输入/选择问题
    ↓
调用AI服务
    ↓
显示解答结果
```

## 使用方法

### 用户操作流程

1. 完成占卜分析，查看占卜结果
2. 滚动到页面底部的"深挖真相"区域
3. 可以：
   - 直接在文本框输入问题
   - 点击建议问题快速填入
4. 点击"🤖 AI 解答"按钮
5. 等待AI思考（显示加载动画）
6. 查看详细的AI解答

### 快捷键

- **Ctrl + Enter** / **Cmd + Enter**: 提交问题

## 多语言支持

功能完整支持三种语言：
- 🇬🇧 English
- 🇨🇳 简体中文
- 🇹🇼 繁體中文

所有界面文本、提示信息、错误信息均已翻译。

## 测试方法

### 快速测试
```bash
# 运行测试脚本
test-divination-followup.bat
```

### 手动测试步骤

1. 启动服务器：`node server.js`
2. 打开浏览器访问：`http://localhost:3000/divination.html`
3. 填写出生信息
4. 选择占卜类别（如：事业）
5. 点击"分析我的命运"
6. 等待占卜结果显示
7. 滚动到底部查看追问功能
8. 测试以下场景：
   - 点击建议问题
   - 手动输入问题
   - 提交并查看AI解答
   - 切换语言测试

## 注意事项

1. **依赖关系**
   - 需要先完成占卜分析才能使用追问功能
   - 依赖AI服务正常运行

2. **错误处理**
   - 空问题提示
   - 未完成占卜提示
   - AI服务失败提示

3. **性能优化**
   - 答案格式化处理
   - 关键词高亮
   - 平滑滚动

## 未来优化方向

1. 支持多轮对话
2. 保存追问历史
3. 更多智能建议问题
4. 语音输入支持
5. 分享追问结果

## 相关文件

- `divination.html` - 主页面
- `divination-followup.js` - 追问功能
- `main.js` - 主逻辑
- `translations.js` - 翻译文件
- `ai-service.js` - AI服务
- `test-divination-followup.bat` - 测试脚本

## 更新日志

### v1.0.0 (2024-12-07)
- ✅ 初始版本发布
- ✅ 支持四大类别的智能建议问题
- ✅ AI智能解答功能
- ✅ 多语言支持（中英繁）
- ✅ 用户体验优化
- ✅ 完整的错误处理

---

**开发者**: Kiro AI Assistant  
**日期**: 2024-12-07  
**版本**: 1.0.0
