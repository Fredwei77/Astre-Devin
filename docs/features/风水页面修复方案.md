# 风水页面修复方案

## 发现的问题

### 1. 翻译问题
- ❌ 商品名称和描述没有根据语言切换
- ❌ 商品按钮文本固定为中文

### 2. AI功能问题
- ❌ 控制台错误：`anime is not defined`
- ❌ AI服务调用失败：`Failed to load resource: the server responded with a status of 500 (Internal Server Error)`
- ❌ 追问功能无法使用

### 3. 脚本加载顺序问题
- ❌ anime.js 已在 HTML 中加载，但 fengshui-ai.js 中使用时报错
- ❌ AI服务初始化时机不对

## 修复方案

### 修复 1: 商店UI多语言支持

已完成：
- ✅ 创建了 `shop-ui-i18n.js` 完整多语言版本
- ✅ 修改了 `shop-ui.js` 添加核心多语言方法

需要做的：
1. 在 fengshui.html 中使用多语言版本的 shop-ui.js
2. 确保 translations.js 在 shop-ui.js 之前加载

### 修复 2: AI功能修复

问题根源：
1. `fengshui-ai.js` 中使用了 `anime` 但可能在加载时 anime 还未就绪
2. `fengshui-followup.js` 中调用 `window.AIService.chat()` 但该方法不存在
3. AI服务需要正确的初始化和错误处理

修复步骤：
1. 修复 fengshui-ai.js 中的 anime 使用
2. 修复 fengshui-followup.js 中的 AI调用
3. 添加适当的错误处理和回退机制

### 修复 3: 脚本加载顺序

当前顺序（有问题）：
```html
<script src="translations.js"></script>
<script src="unified-i18n.js"></script>
<script src="config.js"></script>
<script src="ai-service.js"></script>
...
<script src="main.js"></script>
<script src="fengshui-followup.js"></script>
<script src="shop-service.js"></script>
<script src="shop-ui.js"></script>
```

正确顺序：
```html
<!-- 1. 核心配置 -->
<script src="config.js"></script>

<!-- 2. 翻译系统 -->
<script src="translations.js"></script>
<script src="unified-i18n.js"></script>

<!-- 3. AI服务 -->
<script src="ai-service.js"></script>

<!-- 4. Supabase -->
<script src="supabase-client.js"></script>
<script src="supabase-init.js"></script>

<!-- 5. 认证系统 -->
<script src="auth-service.js"></script>
<script src="auth-guard-enhanced.js"></script>

<!-- 6. 主程序 -->
<script src="main.js"></script>

<!-- 7. 页面特定功能 -->
<script src="fengshui-ai.js"></script>
<script src="fengshui-followup.js"></script>

<!-- 8. 商店系统 -->
<script src="shop-service.js"></script>
<script src="shop-ui-i18n.js"></script>

<!-- 9. 用户菜单 -->
<script src="user-menu.js"></script>
```

## 立即执行的修复

### 文件 1: fengshui-ai-fixed.js
修复 anime 使用和错误处理

### 文件 2: fengshui-followup-fixed.js
修复 AI 调用方法

### 文件 3: fengshui-fixed.html
修复脚本加载顺序和使用多语言商店UI

## 测试步骤

1. 打开 fengshui-fixed.html
2. 切换语言，检查商品名称是否正确切换
3. 上传图片，测试AI分析功能
4. 输入追问，测试AI追问功能
5. 检查控制台是否还有错误

## 预期结果

- ✅ 商品名称和描述根据语言正确显示
- ✅ AI分析功能正常工作
- ✅ AI追问功能正常工作
- ✅ 无控制台错误
