# 风水追问功能说明

## 功能概述

在风水分析结果页面下方新增了AI追问对话框，用户可以针对风水分析结果进行深度追问，获取替代方案和更详细的解答。

## 主要特性

### 1. 智能建议问题
- 根据五行平衡情况自动生成相关的建议追问
- 针对性地提供改善建议
- 点击建议问题可快速填入输入框

### 2. 预设建议问题

**通用问题**
- 如何改善我的财位布局？
- 卧室应该如何摆放才能提升睡眠质量？
- 办公桌的最佳朝向是什么？
- 如何化解家中的煞气？
- 什么颜色最适合我的客厅？
- 如何利用植物提升家居风水？

**五行针对性问题**
- 水元素低：如何增强水元素来提升财运？
- 火元素低：如何增加火元素来提升名气？
- 木元素低：如何补充木元素来促进健康？

### 3. AI智能解答
- 基于用户的风水分析结果提供个性化解答
- 结合传统风水智慧和现代居住环境
- 包含具体分析、改善方法、禁忌事项、推荐物品和操作步骤

### 4. 用户体验优化
- 支持Ctrl+Enter快捷键提交问题
- 加载状态提示
- 答案自动滚动到可视区域
- 关键词高亮显示（方位、五行、颜色等）

## 技术实现

### 文件结构
```
fengshui.html           - 页面HTML结构
fengshui-followup.js    - 追问功能核心逻辑
main.js                 - 集成追问功能初始化
translations.js         - 多语言翻译支持
ai-service.js          - AI服务调用
```

### 核心功能

1. **generateSuggestedQuestions()** - 根据五行平衡生成建议问题
2. **renderSuggestedQuestions()** - 渲染建议问题按钮
3. **handleFollowupQuestion()** - 处理用户追问请求
4. **buildFollowupContext()** - 构建AI对话上下文（包含方位、五行、评分等）
5. **formatAnswer()** - 格式化AI答案显示（高亮风水关键词）

### 数据流程

```
用户上传房间照片
    ↓
进行风水分析
    ↓
显示分析结果
    ↓
初始化追问功能 (FengshuiFollowup.init)
    ↓
生成建议问题（基于五行平衡）
    ↓
用户输入/选择问题
    ↓
调用AI服务（传递完整风水上下文）
    ↓
显示解答结果
```

### 传递的风水上下文

```javascript
{
    direction: '北方',        // 当前方位
    degrees: 0,              // 度数
    elements: {              // 五行平衡
        wood: 70,
        fire: 45,
        earth: 80,
        metal: 60,
        water: 35
    },
    energyScore: 75,         // 整体能量流
    wealthScore: 60,         // 财位评分
    healthScore: 85,         // 健康区域评分
    recommendations: []      // 当前建议列表
}
```

## 使用方法

### 用户操作流程

1. 在风水页面上传房间照片
2. 等待AI分析完成，查看风水分析结果
3. 滚动到页面底部的"替代方案咨询"区域
4. 可以：
   - 直接在文本框输入问题
   - 点击建议问题快速填入
5. 点击"🤖 AI 解答"按钮
6. 等待AI思考（显示加载动画）
7. 查看详细的AI解答

### 快捷键

- **Ctrl + Enter** / **Cmd + Enter**: 提交问题

## 多语言支持

功能完整支持三种语言：
- 🇬🇧 English
- 🇨🇳 简体中文
- 🇹🇼 繁體中文

所有界面文本、提示信息、错误信息均已翻译。

## 测试方法

### 快速测试
```bash
# 运行测试脚本
test-fengshui-followup.bat
```

### 手动测试步骤

1. 启动服务器：`node server.js`
2. 打开浏览器访问：`http://localhost:3000/fengshui.html`
3. 使用罗盘工具调整方位
4. 上传房间照片（或跳过此步骤）
5. 等待风水分析结果显示
6. 滚动到底部查看追问功能
7. 测试以下场景：
   - 点击建议问题
   - 手动输入问题
   - 提交并查看AI解答
   - 切换语言测试

## 注意事项

1. **依赖关系**
   - 需要先完成风水分析才能使用追问功能
   - 依赖AI服务正常运行

2. **错误处理**
   - 空问题提示
   - 未完成分析提示
   - AI服务失败提示

3. **性能优化**
   - 答案格式化处理
   - 关键词高亮（方位、五行、颜色等）
   - 平滑滚动

## 关键词高亮

系统会自动高亮以下风水关键词：
- **建议词**: 建议、注意、适合、避免、提升、改善
- **布局词**: 布局、方位、财位、文昌位、桃花位
- **方位词**: 东、南、西、北、东南、西南、东北、西北
- **五行**: 木、火、土、金、水
- **物品**: 植物、水晶、镜子

## 未来优化方向

1. 支持多轮对话
2. 保存追问历史
3. 更多智能建议问题
4. 图片标注功能
5. 3D空间可视化
6. 分享追问结果

## 相关文件

- `fengshui.html` - 主页面
- `fengshui-followup.js` - 追问功能
- `main.js` - 主逻辑
- `translations.js` - 翻译文件
- `ai-service.js` - AI服务
- `test-fengshui-followup.bat` - 测试脚本

## 更新日志

### v1.0.0 (2024-12-07)
- ✅ 初始版本发布
- ✅ 支持基于五行平衡的智能建议问题
- ✅ AI智能解答功能
- ✅ 多语言支持（中英繁）
- ✅ 用户体验优化
- ✅ 完整的错误处理
- ✅ 风水关键词高亮

## 与占卜追问功能的区别

| 特性 | 占卜追问 | 风水追问 |
|------|---------|---------|
| 上下文 | 出生信息、占卜类别 | 方位、五行平衡、评分 |
| 建议问题 | 基于占卜类别 | 基于五行平衡 |
| 关键词 | 运势、时机、改善 | 方位、五行、布局 |
| 应用场景 | 个人命运分析 | 空间环境优化 |

---

**开发者**: Kiro AI Assistant  
**日期**: 2024-12-07  
**版本**: 1.0.0
