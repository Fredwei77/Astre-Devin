# å•†åº—åŠ è´­åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜è¯Šæ–­

### å‘ç°çš„é—®é¢˜
1. **shop-service.js è¢«æ³¨é‡Šæ‰** - åœ¨ `fengshui.html` ä¸­ï¼Œ`shop-service.js` è¢«æ³¨é‡Šæ‰äº†ï¼Œå¯¼è‡´ `ShopService` ä¸å¯ç”¨
2. **shop-ui.js ä¾èµ–ç¼ºå¤±** - `shop-ui.js` ä¾èµ– `ShopService`ï¼Œä½†ç”±äºæœåŠ¡æœªåŠ è½½å¯¼è‡´åŠ è´­åŠŸèƒ½å¤±è´¥

### é—®é¢˜åŸå› 
```html
<!-- ä¹‹å‰çš„ä»£ç  -->
<!-- æš‚æ—¶ç¦ç”¨ shop-service.js ä»¥é¿å…æ•°æ®åº“é”™è¯¯ï¼Œé…ç½®æ•°æ®åº“åå¯å–æ¶ˆæ³¨é‡Š -->
<!-- <script src="shop-service.js"></script> -->
<script src="shop-ui.js"></script>
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å–æ¶ˆæ³¨é‡Š shop-service.js
å·²ä¿®å¤ `fengshui.html`ï¼Œæ¢å¤ `shop-service.js` çš„åŠ è½½ï¼š

```html
<!-- ä¿®å¤åçš„ä»£ç  -->
<script src="shop-service.js"></script>
<script src="shop-ui.js"></script>
```

### 2. æ•°æ®åº“å·²é…ç½®
æ ¹æ®æ‚¨æä¾›çš„æˆªå›¾ï¼ŒSupabase æ•°æ®åº“å·²ç»æ­£ç¡®è®¾ç½®ï¼š
- âœ… products è¡¨å·²åˆ›å»ºå¹¶æœ‰æ•°æ®
- âœ… cart_items è¡¨å·²åˆ›å»º
- âœ… orders è¡¨å·²åˆ›å»º
- âœ… order_items è¡¨å·²åˆ›å»º
- âœ… shipping_addresses è¡¨å·²åˆ›å»º

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•é¡µé¢ï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œæµ‹è¯•
test-shop-cart.bat
```

æµ‹è¯•é¡µé¢ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼š
- Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–
- ç”¨æˆ·ç™»å½•çŠ¶æ€
- å•†å“åˆ—è¡¨åŠ è½½
- è´­ç‰©è½¦åŠŸèƒ½
- åŠ è´­æ“ä½œ

### æ–¹æ³•äºŒï¼šç›´æ¥æµ‹è¯•é£æ°´é¡µé¢
```bash
# æ‰“å¼€é£æ°´é¡µé¢
start fengshui.html
```

æµ‹è¯•æ­¥éª¤ï¼š
1. ç¡®ä¿å·²ç™»å½•ï¼ˆå³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼‰
2. æ»šåŠ¨åˆ°"Feng Shui Items Shop"éƒ¨åˆ†
3. ç‚¹å‡»ä»»æ„å•†å“çš„"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®
4. æŸ¥çœ‹è´­ç‰©è½¦å›¾æ ‡æ•°å­—æ˜¯å¦å¢åŠ 
5. ç‚¹å‡»è´­ç‰©è½¦å›¾æ ‡æŸ¥çœ‹è´­ç‰©è½¦å†…å®¹

## ğŸ“‹ å®Œæ•´çš„åŠ è´­æµç¨‹

### å‰ç«¯æµç¨‹
```javascript
// 1. ç”¨æˆ·ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"
shopUI.addToCart(productId)

// 2. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
const user = await EnhancedAuthService.getCurrentUser()

// 3. è°ƒç”¨ ShopService æ·»åŠ åˆ°è´­ç‰©è½¦
const result = await ShopService.cart.add(productId, 1)

// 4. æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
await shopUI.loadCart()
```

### æ•°æ®åº“æ“ä½œ
```javascript
// ShopService.cart.add() æ‰§è¡Œï¼š
// 1. æ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å·²æœ‰è¯¥å•†å“
const existing = await supabaseClient
    .from('cart_items')
    .select('*')
    .eq('user_id', user.id)
    .eq('product_id', productId)
    .single()

// 2a. å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡
if (existing) {
    await supabaseClient
        .from('cart_items')
        .update({ quantity: existing.quantity + 1 })
        .eq('id', existing.id)
}

// 2b. å¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥æ–°è®°å½•
else {
    await supabaseClient
        .from('cart_items')
        .insert({
            user_id: user.id,
            product_id: productId,
            quantity: 1
        })
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæç¤º"è¯·å…ˆç™»å½•"
**åŸå› **ï¼šç”¨æˆ·æœªç™»å½•
**è§£å†³**ï¼š
1. ç‚¹å‡»å³ä¸Šè§’"ç™»å…¥"æŒ‰é’®
2. ä½¿ç”¨å·²æ³¨å†Œçš„è´¦å·ç™»å½•
3. æˆ–è€…æ³¨å†Œæ–°è´¦å·

### é—®é¢˜2ï¼šæç¤º"å•†åº—åŠŸèƒ½éœ€è¦é…ç½®æ•°æ®åº“"
**åŸå› **ï¼šSupabase å®¢æˆ·ç«¯æœªåˆå§‹åŒ–æˆ– ShopService æœªåŠ è½½
**è§£å†³**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤ `shop-service.js` å·²æ­£ç¡®åŠ è½½
3. ç¡®è®¤ Supabase é…ç½®æ­£ç¡®

### é—®é¢˜3ï¼šåŠ è´­åè´­ç‰©è½¦æ•°å­—ä¸æ›´æ–°
**åŸå› **ï¼šè´­ç‰©è½¦åˆ·æ–°å¤±è´¥
**è§£å†³**ï¼š
1. åˆ·æ–°é¡µé¢é‡è¯•
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. ç¡®è®¤æ•°æ®åº“ cart_items è¡¨æƒé™æ­£ç¡®

### é—®é¢˜4ï¼šæ•°æ®åº“æƒé™é”™è¯¯
**åŸå› **ï¼šRLS (Row Level Security) ç­–ç•¥æœªæ­£ç¡®é…ç½®
**è§£å†³**ï¼š
åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œï¼š

```sql
-- å…è®¸å·²ç™»å½•ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è´­ç‰©è½¦
CREATE POLICY "Users can view own cart"
ON cart_items FOR SELECT
USING (auth.uid() = user_id);

-- å…è®¸å·²ç™»å½•ç”¨æˆ·æ·»åŠ åˆ°è´­ç‰©è½¦
CREATE POLICY "Users can insert own cart"
ON cart_items FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- å…è®¸å·²ç™»å½•ç”¨æˆ·æ›´æ–°è‡ªå·±çš„è´­ç‰©è½¦
CREATE POLICY "Users can update own cart"
ON cart_items FOR UPDATE
USING (auth.uid() = user_id);

-- å…è®¸å·²ç™»å½•ç”¨æˆ·åˆ é™¤è‡ªå·±çš„è´­ç‰©è½¦é¡¹
CREATE POLICY "Users can delete own cart"
ON cart_items FOR DELETE
USING (auth.uid() = user_id);
```

## ğŸ“Š éªŒè¯æ¸…å•

- [x] shop-service.js å·²å–æ¶ˆæ³¨é‡Š
- [x] fengshui.html å·²æ›´æ–°
- [x] æ•°æ®åº“è¡¨å·²åˆ›å»º
- [x] æµ‹è¯•é¡µé¢å·²åˆ›å»º
- [ ] ç”¨æˆ·å·²ç™»å½•
- [ ] å•†å“å¯ä»¥æˆåŠŸåŠ å…¥è´­ç‰©è½¦
- [ ] è´­ç‰©è½¦æ•°å­—æ­£ç¡®æ›´æ–°
- [ ] è´­ç‰©è½¦å†…å®¹æ­£ç¡®æ˜¾ç¤º

## ğŸš€ ä¸‹ä¸€æ­¥

1. **è¿è¡Œæµ‹è¯•**ï¼šæ‰§è¡Œ `test-shop-cart.bat` éªŒè¯åŠŸèƒ½
2. **æ£€æŸ¥æƒé™**ï¼šå¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼Œåœ¨ Supabase ä¸­é…ç½® RLS ç­–ç•¥
3. **æµ‹è¯•å®Œæ•´æµç¨‹**ï¼šä»æµè§ˆå•†å“åˆ°ç»“ç®—çš„å®Œæ•´è´­ç‰©æµç¨‹
4. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**ï¼šæ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–æç¤ºä¿¡æ¯å’Œé”™è¯¯å¤„ç†

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ä¾èµ–å…³ç³»
```
fengshui.html
â”œâ”€â”€ supabase-client.js (Supabase å®¢æˆ·ç«¯é…ç½®)
â”œâ”€â”€ supabase-init.js (åˆå§‹åŒ–å’Œè®¤è¯æœåŠ¡)
â”œâ”€â”€ shop-service.js (å•†åº—æ•°æ®æœåŠ¡) â† å·²ä¿®å¤
â””â”€â”€ shop-ui.js (å•†åº—UIé€»è¾‘)
```

### å…³é”®æœåŠ¡
- **ShopService.products** - å•†å“ç®¡ç†
- **ShopService.cart** - è´­ç‰©è½¦ç®¡ç†
- **ShopService.orders** - è®¢å•ç®¡ç†
- **ShopService.addresses** - åœ°å€ç®¡ç†

### æ•°æ®åº“è¡¨ç»“æ„
- **products** - å•†å“ä¿¡æ¯
- **cart_items** - è´­ç‰©è½¦é¡¹ï¼ˆå…³è” user_id å’Œ product_idï¼‰
- **orders** - è®¢å•ä¸»è¡¨
- **order_items** - è®¢å•æ˜ç»†
- **shipping_addresses** - æ”¶è´§åœ°å€

## âœ¨ ä¿®å¤å®Œæˆ

å•†åº—åŠ è´­åŠŸèƒ½å·²ä¿®å¤ï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š
1. âœ… æµè§ˆå•†å“
2. âœ… åŠ å…¥è´­ç‰©è½¦
3. âœ… æŸ¥çœ‹è´­ç‰©è½¦
4. âœ… æ›´æ–°æ•°é‡
5. âœ… åˆ é™¤å•†å“
6. âœ… ç»“ç®—ä¸‹å•

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—æˆ–è¿è¡Œæµ‹è¯•é¡µé¢è¿›è¡Œè¯Šæ–­ã€‚
