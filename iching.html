<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I-Ching Divination - Destiny AI</title>
    <meta name="description"
        content="Consult the ancient Book of Changes for guidance. Get personalized I-Ching readings with modern AI interpretation for better life decisions.">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Serif:wght@400;700&family=Noto+Sans+SC:wght@300;400;500&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Mystical Eastern Theme -->
    <link rel="stylesheet" href="mystical-theme.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- User Menu Styles -->
    <link rel="stylesheet" href="user-menu.css">

    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script>

    <!-- Language Switcher -->
    <!-- Unified Translation System -->
    <script src="translations.js"></script>
    <script src="unified-i18n.js"></script>
    <script src="api-config.js"></script>
    <script src="config.js"></script>
    <script src="subscription-manager.js"></script>
    <script src="ai-service.js"></script>

    <!-- Stripe Payment Integration -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="stripe-client-enhanced.js"></script>
    <script src="state-preserver.js"></script>

    <script src="main.js"></script>
    <script src="iching-ai.js"></script>
    <script src="iching-fixes.js"></script>
    <script src="report-export.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-navy': '#1a237e',
                        'mystic-gold': '#ffd700',
                        'moon-silver': '#c0c0c0',
                        'ink-black': '#2c2c2c',
                        'warm-white': '#fafafa',
                        'pale-gold': '#fff8dc',
                        'mystic-purple': '#4a148c'
                    },
                    fontFamily: {
                        'serif-sc': ['Noto Serif SC', 'serif'],
                        'serif': ['Noto Serif', 'serif'],
                        'sans-sc': ['Noto Sans SC', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Body background now handled by mystical-theme.css */

        .divination-card {
            -webkit-backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Special styling for method selection with background image */
        #methodSection .divination-card {
            position: relative;
            background-image: url('resources/iching-background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        #methodSection .divination-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
            z-index: 0;
        }

        #methodSection .divination-card>* {
            position: relative;
            z-index: 1;
        }

        .hexagram-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin: 20px 0;
        }

        .hexagram-line {
            width: 120px;
            height: 12px;
            background: linear-gradient(90deg, #ffd700, #c0c0c0);
            border-radius: 6px;
            position: relative;
            transition: all 0.5s ease;
        }

        .hexagram-line.broken {
            background: linear-gradient(90deg, transparent 40%, #ffd700 40%, #ffd700 60%, transparent 60%);
        }

        .hexagram-line.changing {
            background: linear-gradient(90deg, #ff6b6b, #ffd700);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .coin {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .coin-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }

        .coin:hover .coin-image {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .coin.flipping {
            animation: flip 1s ease-in-out;
        }

        @keyframes flip {
            0% {
                transform: rotateY(0deg) scale(1);
            }

            50% {
                transform: rotateY(180deg) scale(1.2);
            }

            100% {
                transform: rotateY(360deg) scale(1);
            }
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .method-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .method-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .method-card.selected {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .interpretation-card {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #ffd700;
            transition: all 0.3s ease;
        }

        .interpretation-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .question-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fafafa;
            width: 100%;
            resize: vertical;
            min-height: 100px;
        }

        .question-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        .question-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .question-tag {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #c0c0c0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .question-tag:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        .question-tag:active {
            transform: translateY(0);
        }

        .casting-animation {
            animation: casting 2s ease-in-out;
        }

        @keyframes casting {
            0% {
                transform: translateY(0px);
            }

            25% {
                transform: translateY(-20px);
            }

            50% {
                transform: translateY(-40px);
            }

            75% {
                transform: translateY(-20px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        /* Mobile Music Controls Styling */
        .touch-manipulation {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            border-radius: 2px;
            background: rgba(192, 192, 192, 0.3);
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            border: none;
        }

        /* Mobile-specific music notification */
        .mobile-music-toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #ffd700;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-music-toast.show {
            opacity: 1;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .mystical-particles {
                display: none;
                /* Reduce GPU load on mobile */
            }

            #musicControl button {
                backdrop-filter: blur(8px);
                /* Reduce blur for performance */
            }
        }
    </style>
</head>

<body class="font-inter text-warm-white">
    <!-- Background Music -->
    <audio id="backgroundMusic" loop preload="auto">
        <source src="Music/Meditation.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Music Control Button with Mobile Optimization -->
    <div id="musicControl" class="fixed bottom-4 right-4 sm:bottom-6 sm:right-6 z-50">
        <button id="musicToggle"
            class="bg-mystic-gold/20 backdrop-blur-sm border border-mystic-gold/30 text-mystic-gold hover:bg-mystic-gold hover:text-deep-navy active:scale-95 transition-all duration-300 rounded-full w-14 h-14 sm:w-12 sm:h-12 flex items-center justify-center shadow-lg touch-manipulation"
            title="Toggle Background Music">
            <span id="musicIcon" class="text-xl sm:text-lg">ğŸµ</span>
        </button>
        <!-- Volume Control Slider for Mobile -->
        <div id="volumeSlider"
            class="absolute bottom-16 right-0 bg-black/80 backdrop-blur-sm border border-mystic-gold/30 rounded-lg p-3 hidden">
            <div class="flex items-center space-x-2">
                <span class="text-xs text-mystic-gold">ğŸ”Š</span>
                <input type="range" id="volumeRange" min="0" max="100" value="30" class="volume-slider">
                <span id="volumeDisplay" class="text-xs text-mystic-gold">30%</span>
            </div>
        </div>
    </div>

    <!-- Mystical Particle Effects -->
    <div class="mystical-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 mystical-nav border-b border-moon-silver/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div
                        class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden border border-mystic-gold/50 bg-black/50">
                        <img src="resources/logo-processed.png" alt="Dragon Logo" class="w-full h-full object-cover">
                    </div>
                    <span class="text-xl font-serif font-bold glow-text" data-i18n="brand.name">ä¹ ç­®</span>
                </div>

                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="hover:text-mystic-gold transition-colors" data-i18n="nav.home">Home</a>
                    <a href="divination.html" class="hover:text-mystic-gold transition-colors"
                        data-i18n="nav.divination">Divination</a>
                    <a href="fengshui.html" class="hover:text-mystic-gold transition-colors"
                        data-i18n="nav.fengshui">Feng Shui</a>
                    <a href="iching.html" class="text-mystic-gold" data-i18n="nav.iching">I-Ching</a>
                    <a href="calendar.html" class="hover:text-mystic-gold transition-colors"
                        data-i18n="nav.calendar">Calendar</a>
                    <a href="about.html" class="hover:text-mystic-gold transition-colors" data-i18n="nav.about">About
                        Us</a>
                    <a href="profile.html" class="hover:text-mystic-gold transition-colors"
                        data-i18n="nav.profile">Profile</a>
                </div>

                <div class="flex items-center space-x-4">
                    <select id="languageSelect"
                        class="bg-transparent border border-moon-silver/30 rounded px-3 py-1 text-sm">
                        <option value="en">English</option>
                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                        <option value="es">EspaÃ±ol</option>
                    </select>

                    <!-- Login/User Section -->
                    <div id="authSection" class="flex items-center space-x-3">
                        <!-- Guest View (Not Logged In) -->
                        <div id="guestView" class="flex items-center space-x-3">
                            <button id="loginBtn"
                                class="text-moon-silver hover:text-mystic-gold transition-colors font-medium flex items-center gap-2"
                                style="color: #c0c0c0;">
                                <span data-i18n="nav.login">ç™»å…¥</span>
                            </button>
                            <a href="payment.html"
                                class="bg-mystic-gold text-deep-navy px-4 py-2 rounded-lg font-medium hover:bg-yellow-400 transition-colors"
                                style="background: #ffd700; color: #1a237e;" data-i18n="nav.upgrade">
                                Upgrade
                            </a>
                        </div>

                        <!-- User View (Logged In) -->
                        <div id="userView" class="hidden">
                            <div class="flex items-center space-x-3">
                                <!-- User Avatar and Name -->
                                <div class="flex items-center space-x-2 user-avatar-container">
                                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-mystic-gold to-moon-silver flex items-center justify-center border-2 border-mystic-gold/50 shadow-lg"
                                        style="background: linear-gradient(135deg, #ffd700, #c0c0c0);">
                                        <img id="userAvatar" src="" alt="User Avatar"
                                            class="w-full h-full rounded-full object-cover hidden">
                                        <i id="userIcon" class="fas fa-user text-deep-navy text-sm"
                                            style="color: #1a237e;"></i>
                                    </div>
                                    <div class="flex flex-col">
                                        <span id="userName" class="text-moon-silver font-medium text-sm"
                                            style="color: #c0c0c0;"></span>
                                        <span id="userLevel" class="text-mystic-gold text-xs hidden"
                                            style="color: #ffd700;">VIP</span>
                                    </div>
                                </div>

                                <!-- Dropdown Menu Button -->
                                <div class="relative">
                                    <button id="userMenuBtn"
                                        class="text-moon-silver hover:text-mystic-gold transition-all duration-300 p-2 hover:bg-mystic-gold/10 rounded-full"
                                        style="color: #c0c0c0;">
                                        <i class="fas fa-chevron-down text-sm"></i>
                                    </button>

                                    <!-- Dropdown Menu -->
                                    <div id="userMenu"
                                        class="absolute right-0 mt-2 w-56 bg-black/95 backdrop-blur-md border-2 border-mystic-gold/30 rounded-xl shadow-2xl hidden z-50 overflow-hidden">
                                        <!-- User Info Card -->
                                        <div class="user-info-card">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-mystic-gold to-moon-silver flex items-center justify-center border-2 border-mystic-gold/50"
                                                    style="background: linear-gradient(135deg, #ffd700, #c0c0c0);">
                                                    <i class="fas fa-user text-deep-navy" style="color: #1a237e;"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div id="menuUserName"
                                                        class="text-warm-white font-semibold text-sm"></div>
                                                    <div id="menuUserEmail" class="user-email"></div>
                                                    <div id="menuUserStatus" class="user-status">å…è´¹ä¼šå‘˜</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Menu Items -->
                                        <div class="py-2">
                                            <a href="profile.html"
                                                class="flex items-center px-4 py-3 text-moon-silver hover:text-mystic-gold hover:bg-mystic-gold/10 transition-all"
                                                style="color: #c0c0c0;">
                                                <i class="fas fa-user-circle w-5"></i>
                                                <span class="ml-3" data-i18n="nav.profile">ä¸ªäººä¿¡æ¯</span>
                                            </a>

                                            <a href="profile.html#readings"
                                                class="flex items-center px-4 py-3 text-moon-silver hover:text-mystic-gold hover:bg-mystic-gold/10 transition-all"
                                                style="color: #c0c0c0;">
                                                <i class="fas fa-history w-5"></i>
                                                <span class="ml-3" data-i18n="nav.myReadings">æˆ‘çš„å åœ</span>
                                            </a>

                                            <a href="payment.html"
                                                class="flex items-center px-4 py-3 text-moon-silver hover:text-mystic-gold hover:bg-mystic-gold/10 transition-all"
                                                style="color: #c0c0c0;">
                                                <i class="fas fa-crown w-5"></i>
                                                <span class="ml-3" data-i18n="nav.upgrade">ä¼šå‘˜å‡çº§</span>
                                                <span
                                                    class="ml-auto text-xs bg-mystic-gold text-deep-navy px-2 py-1 rounded-full font-bold"
                                                    style="background: #ffd700; color: #1a237e;">HOT</span>
                                            </a>

                                            <a href="profile.html#settings"
                                                class="flex items-center px-4 py-3 text-moon-silver hover:text-mystic-gold hover:bg-mystic-gold/10 transition-all"
                                                style="color: #c0c0c0;">
                                                <i class="fas fa-cog w-5"></i>
                                                <span class="ml-3" data-i18n="nav.settings">è®¾ç½®</span>
                                            </a>
                                        </div>

                                        <hr class="border-mystic-gold/20 mx-3">

                                        <!-- Logout Button -->
                                        <div class="py-2">
                                            <button id="logoutBtn"
                                                class="w-full flex items-center px-4 py-3 text-moon-silver hover:text-red-400 hover:bg-red-400/10 transition-all"
                                                style="color: #c0c0c0;">
                                                <i class="fas fa-sign-out-alt w-5"></i>
                                                <span class="ml-3" data-i18n="nav.logout">é€€å‡ºç™»å½•</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-serif font-bold mb-6 glow-text" data-i18n="iching.title">
                    I-Ching Divination
                </h1>
                <p class="text-xl text-moon-silver max-w-3xl mx-auto" data-i18n="iching.subtitle">
                    Consult the ancient Book of Changes for guidance on important life decisions.
                    Our AI interprets the hexagrams in the context of your modern life challenges.
                </p>
            </div>

            <!-- Divination Methods -->
            <div id="methodSection" class="max-w-4xl mx-auto mb-12">
                <div class="divination-card rounded-xl p-8">
                    <h2 class="text-2xl font-serif font-bold mb-6 text-center">
                        <span class="text-mystic-gold">ğŸ“¿</span> <span data-i18n="iching.guidance.title">å¦å‰æç¤º</span>
                    </h2>

                    <!-- å¦å‰æç¤ºå†…å®¹ -->
                    <div class="bg-white/5 rounded-lg p-6 mb-8 border border-mystic-gold/30">
                        <div class="space-y-4 text-moon-silver leading-relaxed">
                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">1.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule1.title">æ— äº‹ä¸å </span>ï¼š
                                    <span
                                        data-i18n="iching.guidance.rule1.desc">åœå¦æ˜¯ä¸ºäº†åœ¨è¿·èŒ«æ—¶æ›´å¥½åœ°æŠ‰æ‹©ï¼Œæˆä¸ºæ›´å¥½çš„è‡ªå·±ï¼Œé¡ºå…¶è‡ªç„¶ä¸ºä¸Šï¼Œå…ˆå°½äººäº‹ï¼Œåå¬å¤©å‘½ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">2.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule2.title">ä½“è€—ä¸å </span>ï¼š
                                    <span data-i18n="iching.guidance.rule2.desc">é¥®é…’ã€æ€§ç”Ÿæ´»ã€å‰§çƒˆè¿åŠ¨åï¼Œåœ¨çŠ¶æ€æœªæ¢å¤å‰å°½é‡ä¸è¿›è¡Œæ˜“å ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">3.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule3.title">å¿ƒç–²ä¸å </span>ï¼š
                                    <span data-i18n="iching.guidance.rule3.desc">è¿‡åˆ†ç–²åŠ³æˆ–ç²¾ç¥ã€å¿ƒç†çŠ¶æ€ä¸ä½³æ—¶å°½é‡ä¸è¿›è¡Œæ˜“å ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">4.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule4.title">å¤©å¼‚ä¸å </span>ï¼š
                                    <span data-i18n="iching.guidance.rule4.desc">æ°”å€™å¼‚å¸¸ã€ç¯å¢ƒç‰¹åˆ«å’ŒèŠ‚ä»¤äº¤æ›¿ç­‰ç‰¹åˆ«æ—¶é—´é‡Œï¼Œå°½é‡ä¸è¿›è¡Œæ˜“å ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">5.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule5.title">ç–‘åˆ™ä¸å </span>ï¼š
                                    <span data-i18n="iching.guidance.rule5.desc">å¿ƒè¯šåˆ™çµï¼Œå¦‚æœå†…å¿ƒè¿˜æŒæœ‰è¾ƒå¤§çš„æ€€ç–‘ï¼Œä¸å»ºè®®è¿›è¡Œæ˜“å ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">6.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule6.title">é¿ä¼—è€Œå </span>ï¼š
                                    <span data-i18n="iching.guidance.rule6.desc">å°½é‡ä¸åœ¨ä¸‰äººä»¥ä¸Šçš„åœºåˆä¸ºä»–äººæ˜“å ã€‚</span>
                                </p>
                            </div>

                            <div class="flex items-start space-x-3">
                                <span class="text-mystic-gold font-bold text-lg flex-shrink-0">7.</span>
                                <p><span class="text-mystic-gold font-semibold"
                                        data-i18n="iching.guidance.rule7.title">é™å¿ƒè€Œå </span>ï¼š
                                    <span data-i18n="iching.guidance.rule7.desc">æ‰¾ä¸€ä¸ªå®‰é™çš„ç¯å¢ƒï¼Œä¸åœ¨æ˜“å çš„åŒæ—¶åšä¸æ˜“å æ— å…³çš„äº‹æƒ…ã€‚</span>
                                </p>
                            </div>
                        </div>

                        <!-- å åœæ–¹æ³•è¯´æ˜ -->
                        <div class="mt-6 pt-6 border-t border-mystic-gold/20 text-center">
                            <div class="inline-flex items-center space-x-3 bg-mystic-gold/10 rounded-lg px-6 py-3">
                                <img src="resources/five-emperor-coin-front.png" alt="Five Emperor Coins"
                                    class="w-12 h-12 rounded-full shadow-lg">
                                <div class="text-left">
                                    <h4 class="text-mystic-gold font-bold" data-i18n="iching.method.coins">ä¸‰æšç¡¬å¸æ³•</h4>
                                    <p class="text-xs text-moon-silver" data-i18n="iching.method.coins.desc">
                                        ä½¿ç”¨ä¸‰æšç¡¬å¸æŠ•æ·å…­æ¬¡æ¥æ„å»ºå¦è±¡çš„ä¼ ç»Ÿæ–¹æ³•</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question Input -->
                    <div class="mb-8">
                        <label class="block text-moon-silver mb-3 font-medium"
                            data-i18n="iching.question.label">æ‚¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</label>
                        <textarea id="questionInput" class="question-input"
                            data-i18n-placeholder="iching.question.placeholder"
                            placeholder="ä¸“æ³¨äºæ‚¨éœ€è¦æŒ‡å¯¼çš„å…·ä½“é—®é¢˜æˆ–æƒ…å†µã€‚æ¸…æ™°æ˜ç¡®åœ°è¯´æ˜æ‚¨æƒ³çŸ¥é“ä»€ä¹ˆã€‚"></textarea>

                        <!-- å¸¸è§é—®é¢˜é€‰é¡¹ -->
                        <div class="mt-4">
                            <p class="text-sm text-moon-silver mb-3">
                                <span class="text-mystic-gold">ğŸ’¡</span> <span
                                    data-i18n="iching.question.common">å¸¸è§é—®é¢˜ï¼ˆç‚¹å‡»å¿«é€Ÿå¡«å…¥ï¼‰ï¼š</span>
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <button type="button" class="question-tag" data-question="æˆ‘åº”è¯¥æ¢å·¥ä½œå—ï¼Ÿ">
                                    <span data-i18n="iching.question.sample1">æˆ‘åº”è¯¥æ¢å·¥ä½œå—ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="è¿™æ®µæ„Ÿæƒ…èƒ½é•¿ä¹…å—ï¼Ÿ">
                                    <span data-i18n="iching.question.sample2">è¿™æ®µæ„Ÿæƒ…èƒ½é•¿ä¹…å—ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="è¿™ä¸ªé¡¹ç›®èƒ½æˆåŠŸå—ï¼Ÿ">
                                    <span data-i18n="iching.question.sample3">è¿™ä¸ªé¡¹ç›®èƒ½æˆåŠŸå—ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="æˆ‘è¯¥å¦‚ä½•æ”¹å–„è´¢è¿ï¼Ÿ">
                                    <span data-i18n="iching.question.sample4">æˆ‘è¯¥å¦‚ä½•æ”¹å–„è´¢è¿ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="ç°åœ¨æ˜¯åˆ›ä¸šçš„å¥½æ—¶æœºå—ï¼Ÿ">
                                    <span data-i18n="iching.question.sample5">ç°åœ¨æ˜¯åˆ›ä¸šçš„å¥½æ—¶æœºå—ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="æˆ‘å’ŒTAçš„å…³ç³»ä¼šå¦‚ä½•å‘å±•ï¼Ÿ">
                                    <span data-i18n="iching.question.sample6">æˆ‘å’ŒTAçš„å…³ç³»ä¼šå¦‚ä½•å‘å±•ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="æˆ‘è¯¥é€‰æ‹©å“ªä¸ªæ–¹å‘å‘å±•ï¼Ÿ">
                                    <span data-i18n="iching.question.sample7">æˆ‘è¯¥é€‰æ‹©å“ªä¸ªæ–¹å‘å‘å±•ï¼Ÿ</span>
                                </button>
                                <button type="button" class="question-tag" data-question="å¦‚ä½•åŒ–è§£å½“å‰çš„å›°å¢ƒï¼Ÿ">
                                    <span data-i18n="iching.question.sample8">å¦‚ä½•åŒ–è§£å½“å‰çš„å›°å¢ƒï¼Ÿ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button id="startDivination"
                            class="bg-mystic-gold text-deep-navy px-8 py-4 rounded-lg font-semibold text-lg hover:bg-yellow-400 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            data-i18n="iching.button.begin">
                            Begin Divination
                        </button>
                    </div>
                </div>
            </div>

            <!-- Coin Casting Section -->
            <div id="coinSection" class="max-w-4xl mx-auto mb-12 hidden">
                <div class="divination-card rounded-xl p-8 text-center">
                    <h2 class="text-2xl font-serif font-bold mb-6" data-i18n="iching.cast.title">Cast the Coins</h2>
                    <p class="text-moon-silver mb-8" data-i18n="iching.cast.instruction">Focus on your question and
                        click the coins to cast them. Repeat this process six times to build your hexagram.</p>

                    <div class="mb-8">
                        <div class="text-lg font-semibold mb-4"><span data-i18n="iching.cast.current">Casting</span>:
                            <span id="currentCast">1</span> <span data-i18n="iching.cast.of">of</span> 6
                        </div>
                        <div class="flex justify-center space-x-6 mb-8">
                            <div class="coin" id="coin1">
                                <img src="resources/five-emperor-coin-front.png" alt="Five Emperor Coin"
                                    class="coin-image">
                            </div>
                            <div class="coin" id="coin2">
                                <img src="resources/five-emperor-coin-front.png" alt="Five Emperor Coin"
                                    class="coin-image">
                            </div>
                            <div class="coin" id="coin3">
                                <img src="resources/five-emperor-coin-front.png" alt="Five Emperor Coin"
                                    class="coin-image">
                            </div>
                        </div>
                        <button id="castCoins"
                            class="bg-mystic-gold text-deep-navy px-6 py-3 rounded-lg font-semibold hover:bg-yellow-400 transition-colors"
                            data-i18n="iching.cast.button">
                            Cast Coins
                        </button>
                    </div>

                    <!-- Hexagram Building -->
                    <div class="hexagram-container">
                        <h3 class="text-lg font-serif font-bold mb-4" data-i18n="iching.hexagram.your">Your Hexagram
                        </h3>
                        <div id="hexagramLines">
                            <!-- Lines will be added here -->
                        </div>
                        <div class="mt-4 text-moon-silver">
                            <p><span data-i18n="iching.hexagram.label">å¦è±¡</span>: <span id="hexagramName"
                                    class="text-mystic-gold font-semibold"
                                    data-i18n="iching.hexagram.building">Building...</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="max-w-6xl mx-auto hidden">
                <div class="divination-card rounded-xl p-8">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-serif font-bold mb-4 glow-text" data-i18n="iching.result.title">Your
                            I-Ching Reading</h2>
                        <p class="text-moon-silver" data-i18n="iching.result.subtitle">The ancient wisdom of the Book of
                            Changes reveals:</p>
                    </div>

                    <!-- Hexagram Display -->
                    <div class="grid lg:grid-cols-2 gap-8 mb-8">
                        <div class="text-center">
                            <h3 class="text-xl font-serif font-bold mb-4" data-i18n="iching.result.primary">Primary
                                Hexagram</h3>
                            <div class="hexagram-container">
                                <div id="finalHexagram">
                                    <!-- Final hexagram will be displayed here -->
                                </div>
                                <div class="mt-4">
                                    <h4 id="hexagramTitle" class="text-lg font-serif font-bold text-mystic-gold mb-2"
                                        data-i18n="iching.default.hexagram.title">
                                        Hexagram 1: The Creative</h4>
                                    <p id="hexagramDescription" class="text-moon-silver text-sm"
                                        data-i18n="iching.default.hexagram.desc">
                                        The creative works sublime success, furthering through perseverance.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <h3 class="text-xl font-serif font-bold mb-4" data-i18n="iching.result.changing">Changing
                                Lines</h3>
                            <div id="changingLines" class="space-y-3">
                                <!-- Changing lines will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Interpretation -->
                    <div class="space-y-6 mb-8">
                        <div class="interpretation-card rounded-lg p-6">
                            <h4 class="text-lg font-serif font-bold mb-3 text-mystic-gold"
                                data-i18n="iching.result.judgment">Judgment</h4>
                            <p id="judgmentText" class="text-moon-silver leading-relaxed"
                                data-i18n="iching.default.judgment">
                                The creative principle manifests itself through the trigram of heaven.
                                This hexagram symbolizes the beginning of all things, the primal creative force
                                that brings order to chaos. It suggests that now is a time for action,
                                for taking the initiative and leading with confidence.
                            </p>
                        </div>

                        <div class="interpretation-card rounded-lg p-6">
                            <h4 class="text-lg font-serif font-bold mb-3 text-mystic-gold"
                                data-i18n="iching.result.image">Image</h4>
                            <p id="imageText" class="text-moon-silver leading-relaxed" data-i18n="iching.default.image">
                                The movement of heaven is powerful and constant. The superior person
                                strengthens themselves and never stops their efforts. Just as heaven
                                moves with enduring strength, you should persist in your goals with
                                unwavering determination.
                            </p>
                        </div>

                        <div class="interpretation-card rounded-lg p-6">
                            <h4 class="text-lg font-serif font-bold mb-3 text-mystic-gold"
                                data-i18n="iching.result.advice">Advice for Your Situation</h4>
                            <p id="adviceText" class="text-moon-silver leading-relaxed"
                                data-i18n="iching.default.advice">
                                Based on your question and this hexagram, the I-Ching advises you to
                                take a leadership role in your current situation. Trust your creative
                                instincts and don't hesitate to act decisively. Your natural talents
                                and abilities are sufficient to handle the challenges ahead.
                            </p>
                        </div>

                        <!-- Changing Lines Analysis -->
                        <div id="changingLinesCard" class="interpretation-card rounded-lg p-6 hidden">
                            <h4 class="text-lg font-serif font-bold mb-3 text-mystic-gold"
                                data-i18n="iching.result.changingAnalysis">Changing Lines Analysis</h4>
                            <p id="changingLinesText" class="text-moon-silver leading-relaxed">
                                <!-- Content will be populated by AI -->
                            </p>
                        </div>

                        <!-- Future Hexagram -->
                        <div id="futureHexagramCard" class="interpretation-card rounded-lg p-6 hidden">
                            <h4 class="text-lg font-serif font-bold mb-3 text-mystic-gold"
                                data-i18n="iching.result.future">Future Outlook (Related Hexagram)</h4>
                            <p id="futureHexagramText" class="text-moon-silver leading-relaxed">
                                <!-- Content will be populated by AI -->
                            </p>
                        </div>
                    </div>

                    <!-- Action Steps -->
                    <div class="bg-white/5 rounded-lg p-6 mb-8">
                        <h3 class="text-xl font-serif font-bold mb-4 text-center text-mystic-gold"
                            data-i18n="iching.result.actions">Recommended Actions</h3>
                        <div id="actionsContainer" class="grid md:grid-cols-2 gap-4">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Warnings -->
                    <div id="warningsSection" class="bg-red-500/10 border border-red-500/20 rounded-lg p-6 mb-8 hidden">
                        <h3 class="text-xl font-serif font-bold mb-4 text-center text-red-400"
                            data-i18n="iching.result.warnings">Warnings & Cautions</h3>
                        <ul id="warningsList" class="space-y-3 text-moon-silver">
                            <!-- Populated by JS -->
                        </ul>
                    </div>

                    <div
                        class="flex flex-col sm:flex-row gap-4 justify-center mb-8 pt-6 border-t border-mystic-gold/20">
                        <button id="exportPDF"
                            class="bg-gradient-to-r from-mystic-purple to-mystic-gold text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all flex items-center justify-center gap-2">
                            <span data-i18n="iching.button.exportPDF_icon">ğŸ“„</span> <span
                                data-i18n="iching.button.exportPDF">ä¿å­˜ä¸º PDF</span>
                        </button>
                        <button id="exportHTML"
                            class="border-2 border-mystic-purple text-mystic-purple px-6 py-3 rounded-lg font-semibold hover:bg-mystic-purple hover:text-white transition-all flex items-center justify-center gap-2">
                            <span data-i18n="iching.button.exportHTML_icon">ğŸ’¾</span> <span
                                data-i18n="iching.button.exportHTML">ä¿å­˜ç½‘é¡µ</span>
                        </button>
                        <button id="resetReading"
                            class="border-2 border-moon-silver text-moon-silver px-6 py-3 rounded-lg font-semibold hover:bg-moon-silver hover:text-deep-navy transition-all flex items-center justify-center gap-2">
                            <span data-i18n="iching.button.reset_icon">ğŸ”„</span> <span
                                data-i18n="iching.button.reset">é‡æ–°æ’ç›˜</span>
                        </button>
                    </div>

                    <!-- AI Follow-up Questions Section -->
                    <div
                        class="bg-gradient-to-br from-mystic-gold/10 to-mystic-purple/10 rounded-xl p-6 border-2 border-mystic-gold/30">
                        <div class="text-center mb-4">
                            <h3 class="text-xl font-serif font-bold text-mystic-gold mb-2">
                                <span class="text-2xl" data-i18n="iching.followup.icon">ğŸ”®</span> <span
                                    data-i18n="iching.followup.title">æ·±æŒ–çœŸç›¸</span>
                            </h3>
                            <p class="text-sm text-moon-silver" data-i18n="iching.followup.subtitle">
                                å¦‚éœ€æ·±æŒ–çœŸç›¸ï¼Œè¯·åœ¨ä¸‹æ–¹å¡«å†™é—®é¢˜
                            </p>
                        </div>

                        <!-- Follow-up Question Input -->
                        <div class="mb-4">
                            <textarea id="followupInput"
                                class="w-full bg-white/10 border border-mystic-gold/30 rounded-lg px-4 py-3 text-warm-white placeholder-moon-silver/50 focus:border-mystic-gold focus:outline-none resize-vertical min-h-[80px]"
                                data-i18n-placeholder="iching.followup.placeholder"
                                placeholder="ä¾‹å¦‚ï¼šå¦‚ä½•æŠŠæ¡è¿™ä¸ªæœºä¼šï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆé£é™©ï¼Ÿ"></textarea>
                        </div>

                        <!-- Suggested Follow-up Questions -->
                        <div class="mb-4">
                            <p class="text-xs text-moon-silver mb-2">
                                ğŸ’¡ <span data-i18n="iching.followup.suggested">å»ºè®®è¿½é—®ï¼š</span>
                            </p>
                            <div class="flex flex-wrap gap-2" id="followupSuggestions">
                                <!-- Will be populated by JS based on divination result -->
                            </div>
                        </div>

                        <!-- Ask Button -->
                        <div class="text-center">
                            <button id="askFollowup"
                                class="bg-mystic-gold text-deep-navy px-8 py-3 rounded-lg font-semibold hover:bg-yellow-400 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="mr-2" data-i18n="iching.followup.button_icon">ğŸ¤–</span> <span
                                    data-i18n="iching.followup.button">AI è§£ç­”</span>
                            </button>
                        </div>

                        <!-- Loading Indicator -->
                        <div id="followupLoading" class="hidden text-center mt-4">
                            <div class="inline-flex items-center px-4 py-2 bg-mystic-gold/20 rounded-lg">
                                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-mystic-gold"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                <span class="text-mystic-gold">AI æ­£åœ¨è§£ç­”ä¸­...</span>
                            </div>
                        </div>

                        <!-- Follow-up Answer -->
                        <div id="followupAnswer" class="hidden mt-6 pt-6 border-t border-mystic-gold/30">
                            <h4 class="text-lg font-serif font-bold text-mystic-gold mb-3"
                                data-i18n="iching.followup.answer">
                                AI è§£ç­”ï¼š
                            </h4>
                            <div id="followupAnswerText"
                                class="text-moon-silver leading-relaxed bg-white/5 rounded-lg p-4">
                                <!-- AI answer will be displayed here -->
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-12" style="background: var(--jade-dark);">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-moon-silver mb-6 max-w-2xl mx-auto" data-i18n="footer.description">
                    Combining ancient Eastern wisdom with modern AI technology to help you discover your destiny.
                </p>

                <div class="flex justify-center space-x-6 mb-6 flex-wrap">
                    <a href="privacy.html" class="text-moon-silver hover:text-mystic-gold transition-colors"
                        data-i18n="footer.privacy">Privacy Policy</a>
                    <a href="support.html" class="text-moon-silver hover:text-mystic-gold transition-colors"
                        data-i18n="footer.support">Support</a>
                    <a href="about.html" class="text-moon-silver hover:text-mystic-gold transition-colors"
                        data-i18n="nav.about">About Us</a>
                </div>

                <!-- Social Media -->
                <div class="mb-6">
                    <h4 class="text-mystic-gold font-semibold mb-3" data-i18n="footer.social">Social Media</h4>
                    <div class="flex justify-center gap-6">
                        <a href="https://xhslink.com/m/40J0nrG5TNW" target="_blank" rel="noopener noreferrer"
                            class="text-moon-silver hover:text-mystic-gold transition-all transform hover:scale-110 group"
                            title="å°çº¢ä¹¦: é­”ç¼˜æ–‡æ ¸">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center shadow-lg group-hover:shadow-mystic-gold/50">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" />
                                </svg>
                            </div>
                        </a>
                        <a href="https://x.com/weiming5311" target="_blank" rel="noopener noreferrer"
                            class="text-moon-silver hover:text-mystic-gold transition-all transform hover:scale-110 group"
                            title="X: @weiming5311">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center shadow-lg group-hover:shadow-mystic-gold/50">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                </svg>
                            </div>
                        </a>
                        <a href="https://www.instagram.com/gentle_pacifier/" target="_blank" rel="noopener noreferrer"
                            class="text-moon-silver hover:text-mystic-gold transition-all transform hover:scale-110 group"
                            title="Instagram: @gentle_pacifier">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 via-pink-500 to-orange-500 flex items-center justify-center shadow-lg group-hover:shadow-mystic-gold/50">
                                <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                                </svg>
                            </div>
                        </a>
                        <a href="mailto:fredwei77@gmail.com"
                            class="text-moon-silver hover:text-mystic-gold transition-all transform hover:scale-110 group"
                            title="Email: fredwei77@gmail.com">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg group-hover:shadow-mystic-gold/50">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                            </div>
                        </a>
                        <a href="tel:+8618665860838"
                            class="text-moon-silver hover:text-mystic-gold transition-all transform hover:scale-110 group"
                            title="+86 186 6586 0838">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg group-hover:shadow-mystic-gold/50">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="border-t border-moon-silver/20 pt-6">
                    <p class="text-moon-silver text-sm" data-i18n="footer.copyright">
                        Â© 2024 Destiny AI. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>


    <script>
        // I-Ching specific functionality
        class IChingDivination {
            constructor() {
                this.selectedMethod = null;
                this.currentCast = 0;
                this.hexagramLines = [];
                this.changingLines = [];
                this.question = '';

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupMethods();
            }

            setupEventListeners() {
                // Method selection
                document.querySelectorAll('.method-card').forEach(card => {
                    card.addEventListener('click', () => {
                        this.selectMethod(card.dataset.method);
                    });
                });

                // Start divination
                const startBtn = document.getElementById('startDivination');
                if (startBtn) {
                    startBtn.addEventListener('click', () => this.startDivination());
                }

                // Coin casting
                const castBtn = document.getElementById('castCoins');
                if (castBtn) {
                    castBtn.addEventListener('click', () => this.castCoins());
                }

                // Result actions
                const saveBtn = document.getElementById('saveReading');
                const shareBtn = document.getElementById('shareReading');
                const newBtn = document.getElementById('newDivination');

                if (saveBtn) saveBtn.addEventListener('click', () => this.saveReading());
                if (shareBtn) shareBtn.addEventListener('click', () => this.shareReading());
                if (newBtn) newBtn.addEventListener('click', () => this.newDivination());

                // Question tags - å¸¸è§é—®é¢˜æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.question-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        e.preventDefault();
                        // ä½¿ç”¨æŒ‰é’®çš„æ–‡æœ¬å†…å®¹è€Œä¸æ˜¯ data-question å±æ€§
                        // è¿™æ ·å¯ä»¥è·å–å½“å‰è¯­è¨€çš„ç¿»è¯‘æ–‡æœ¬
                        const questionSpan = tag.querySelector('[data-i18n]') || tag;
                        const question = questionSpan.textContent.trim();
                        const questionInput = document.getElementById('questionInput');
                        if (questionInput && question) {
                            questionInput.value = question;
                            questionInput.focus();
                            // æ·»åŠ è§†è§‰åé¦ˆ
                            tag.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                tag.style.transform = '';
                            }, 150);
                        }
                    });
                });
            }

            setupMethods() {
                // åªä¿ç•™ä¸‰æšç¡¬å¸æ–¹æ³•
                this.methods = {
                    coins: {
                        name: 'Three Coins',
                        description: 'Traditional coin casting method'
                    }
                };

                // è‡ªåŠ¨é€‰æ‹©ä¸‰æšç¡¬å¸æ–¹æ³•
                this.selectedMethod = 'coins';
            }

            selectMethod(method) {
                this.selectedMethod = method;

                // Update UI
                document.querySelectorAll('.method-card').forEach(card => {
                    card.classList.remove('selected');
                });

                document.querySelector(`[data-method="${method}"]`).classList.add('selected');
            }

            startDivination() {
                const question = document.getElementById('questionInput').value.trim();

                // ç”±äºåªæœ‰ä¸€ä¸ªæ–¹æ³•ä¸”å·²è‡ªåŠ¨é€‰æ‹©ï¼Œä¸éœ€è¦æ£€æŸ¥æ–¹æ³•é€‰æ‹©
                // if (!this.selectedMethod) {
                //     alert('Please select a divination method first.');
                //     return;
                // }

                if (!question) {
                    alert('Please enter your question.');
                    return;
                }

                this.question = question;

                // Hide method section, show coin casting
                document.getElementById('methodSection').classList.add('hidden');
                document.getElementById('coinSection').classList.remove('hidden');

                // Initialize based on method
                this.initializeCasting();
            }

            initializeCasting() {
                this.currentCast = 0;
                this.hexagramLines = [];
                this.changingLines = [];

                // Reset hexagram display
                document.getElementById('hexagramLines').innerHTML = '';
                document.getElementById('hexagramName').textContent = 'Building...';

                // Update casting display
                this.updateCastingDisplay();
            }

            updateCastingDisplay() {
                // Modified to show completed casts (0-6) instead of current attempt (1-7)
                const displayValue = Math.min(this.currentCast, 6); // Cap at 6
                document.getElementById('currentCast').textContent = displayValue;
            }

            castCoins() {
                if (this.currentCast >= 6) return;

                // Animate coins
                const coins = ['coin1', 'coin2', 'coin3'];
                coins.forEach(coinId => {
                    const coin = document.getElementById(coinId);
                    coin.classList.add('flipping');
                });

                // Simulate casting delay
                setTimeout(() => {
                    this.processCast();
                    coins.forEach(coinId => {
                        const coin = document.getElementById(coinId);
                        coin.classList.remove('flipping');
                    });
                }, 1000);
            }

            processCast() {
                // Simulate coin results (2 = heads/yang, 3 = tails/yin)
                const results = [
                    Math.floor(Math.random() * 2) + 2, // 2 or 3
                    Math.floor(Math.random() * 2) + 2,
                    Math.floor(Math.random() * 2) + 2
                ];

                const sum = results.reduce((a, b) => a + b, 0);
                let lineType, isChanging = false;

                // Determine line type
                if (sum === 6) {
                    lineType = 'broken'; // Old yin (changing)
                    isChanging = true;
                } else if (sum === 7) {
                    lineType = 'solid'; // Young yang
                } else if (sum === 8) {
                    lineType = 'broken'; // Young yin
                } else if (sum === 9) {
                    lineType = 'solid'; // Old yang (changing)
                    isChanging = true;
                }

                // Add to hexagram (bottom to top)
                this.hexagramLines.unshift({
                    type: lineType,
                    changing: isChanging,
                    value: sum
                });

                if (isChanging) {
                    this.changingLines.push(6 - this.currentCast); // Line number (1-6, bottom to top)
                }

                this.currentCast++;

                // Update display
                this.updateHexagramDisplay();
                this.updateCastingDisplay();

                // Check if complete
                if (this.currentCast >= 6) {
                    setTimeout(() => this.completeDivination(), 1000);
                }
            }

            updateHexagramDisplay() {
                const container = document.getElementById('hexagramLines');
                container.innerHTML = '';

                this.hexagramLines.forEach((line, index) => {
                    const lineElement = document.createElement('div');
                    lineElement.className = `hexagram-line ${line.type}`;

                    if (line.changing) {
                        lineElement.classList.add('changing');
                    }

                    container.appendChild(lineElement);
                });

                // Update hexagram name based on pattern
                const hexData = this.getHexagramData();
                document.getElementById('hexagramName').textContent = `Hexagram ${hexData.number}`;
            }

            getHexagramData() {
                const pattern = this.hexagramLines.map(line => line.type === 'solid' ? 1 : 0).join('');

                // Map patterns to King Wen numbers
                const patterns = {
                    '111111': 1, '000000': 2, '100010': 3, '010001': 4,
                    '111010': 5, '010111': 6, '010000': 7, '000010': 8,
                    '111011': 9, '110111': 10, '111000': 11, '000111': 12,
                    '101111': 13, '111101': 14, '001010': 15, '010100': 16,
                    '100110': 17, '011001': 18, '110000': 19, '000011': 20,
                    '100101': 21, '101001': 22, '000001': 23, '100000': 24,
                    '111001': 25, '100111': 26, '100001': 27, '011110': 28,
                    '010010': 29, '101101': 30, '001110': 31, '011100': 32,
                    '001111': 33, '111100': 34, '000101': 35, '101000': 36,
                    '101011': 37, '110101': 38, '001011': 39, '110100': 40,
                    '110110': 41, '011011': 42, '111110': 43, '011111': 44,
                    '000100': 45, '001000': 46, '011101': 47, '101110': 48,
                    '001101': 49, '101100': 50, '100100': 51, '001001': 52,
                    '011010': 53, '010110': 54, '101010': 55, '010101': 56,
                    '110010': 57, '010011': 58, '011000': 59, '000110': 60,
                    '110011': 61, '001100': 62, '101000': 63, '000101': 64
                };

                const number = patterns[pattern] || 1;
                return { number, pattern };
            }

            completeDivination() {
                // Hide coin section, show results
                document.getElementById('coinSection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');

                // Animate results appearance
                anime({
                    targets: '#resultsSection',
                    opacity: [0, 1],
                    translateY: [30, 0],
                    duration: 800,
                    easing: 'easeOutQuart'
                });

                // Display initial structure
                const hexData = this.getHexagramData();
                this.displayStructure(hexData.number);

                // Initialize follow-up questions
                this.initializeFollowup();

                // Call AI for interpretation
                if (window.ichingAI) {
                    // Update UI to show loading
                    document.getElementById('judgmentText').innerHTML = '<span class="animate-pulse">Consulting the Oracle...</span>';
                    document.getElementById('imageText').innerHTML = '<span class="animate-pulse">Interpreting symbols...</span>';
                    document.getElementById('adviceText').innerHTML = '<span class="animate-pulse">Formulating advice...</span>';

                    // Call AI
                    window.ichingAI.performDivination(
                        this.question,
                        this.hexagramLines.slice().reverse(), // iching-ai expect Bottom-to-Top
                        this.changingLines,
                        hexData.number // Pass explicit number
                    ).then(result => {
                        console.log('AI Result:', result);
                        // Initialize the new follow-up system with proper data structure
                        const ichingResult = {
                            mainHexagram: hexData.name || `Hexagram ${hexData.number}`,
                            changingLines: this.changingLines,
                            transformedHexagram: 'Calculating...',
                            category: 'I-Ching',
                            summary: result.summary || result.advice || 'I-Ching analysis completed',
                            hexagramNumber: hexData.number,
                            hexagram: {
                                name: hexData.name || `Hexagram ${hexData.number}`,
                                meaning: result.judgment || 'Ancient wisdom...',
                                lines: result.lines || 'Guidance from the lines...'
                            },
                            analysis: result.summary || result.advice || 'Interpretation completed'
                        };

                        // åŒæ­¥åˆ°å¤šä¸ªä¿®å¤è„šæœ¬é¢„æœŸçš„å…¨å±€å˜é‡
                        window.currentIChing = ichingResult;
                        window.ichingResult = ichingResult;

                        // Initialize the deep truth exploration feature
                        if (window.IChingFollowup) {
                            window.IChingFollowup.init(ichingResult);
                        }

                        // Keep the original follow-up for backward compatibility
                        this.generateFollowupSuggestions(result);
                    }).catch(err => {
                        console.error('AI Failed:', err);
                        // Fallback could go here
                        document.getElementById('judgmentText').textContent = 'The oracle is silent at the moment. Please try again later.';
                    });
                } else {
                    console.error('IChingAI not loaded');
                }
            }

            initializeFollowup() {
                const followupInput = document.getElementById('followupInput');
                const askButton = document.getElementById('askFollowup');

                if (askButton) {
                    // Removed to avoid conflict with iching-fixes.js
                    // askButton.addEventListener('click', () => this.handleFollowupQuestion());
                }

                // Add event listeners for suggestion tags
                setTimeout(() => {
                    document.querySelectorAll('.followup-tag').forEach(tag => {
                        tag.addEventListener('click', (e) => {
                            e.preventDefault();
                            const question = tag.dataset.question;
                            if (followupInput && question) {
                                followupInput.value = question;
                                followupInput.focus();
                            }
                        });
                    });
                }, 500);
            }

            generateFollowupSuggestions(result) {
                const container = document.getElementById('followupSuggestions');
                if (!container) return;

                // Generate suggestions based on the original question and result
                const suggestions = this.getFollowupSuggestions(this.question, result);

                container.innerHTML = suggestions.map(q => `
                    <button type="button" class="followup-tag question-tag" data-question="${q}">
                        ${q}
                    </button>
                `).join('');

                // Re-bind event listeners
                document.querySelectorAll('.followup-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        e.preventDefault();
                        const question = tag.dataset.question;
                        const followupInput = document.getElementById('followupInput');
                        if (followupInput && question) {
                            followupInput.value = question;
                            followupInput.focus();
                        }
                    });
                });
            }

            getFollowupSuggestions(originalQuestion, result) {
                // Generate contextual follow-up questions based on the original question
                const questionLower = originalQuestion.toLowerCase();

                // Default suggestions
                let suggestions = [
                    'å…·ä½“åº”è¯¥å¦‚ä½•è¡ŒåŠ¨ï¼Ÿ',
                    'éœ€è¦æ³¨æ„å“ªäº›é£é™©ï¼Ÿ',
                    'æœ€ä½³æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ',
                    'å¦‚ä½•æé«˜æˆåŠŸç‡ï¼Ÿ'
                ];

                // Customize based on question type
                if (questionLower.includes('å·¥ä½œ') || questionLower.includes('èŒä¸š') || questionLower.includes('äº‹ä¸š')) {
                    suggestions = [
                        'å¦‚ä½•æŠŠæ¡è¿™ä¸ªæœºä¼šï¼Ÿ',
                        'éœ€è¦åšå“ªäº›å‡†å¤‡ï¼Ÿ',
                        'å¯èƒ½é‡åˆ°ä»€ä¹ˆé˜»ç¢ï¼Ÿ',
                        'å¦‚ä½•ä¸åŒäº‹ç›¸å¤„ï¼Ÿ'
                    ];
                } else if (questionLower.includes('æ„Ÿæƒ…') || questionLower.includes('çˆ±æƒ…') || questionLower.includes('å…³ç³»')) {
                    suggestions = [
                        'å¦‚ä½•æ”¹å–„æˆ‘ä»¬çš„å…³ç³»ï¼Ÿ',
                        'å¯¹æ–¹çš„çœŸå®æƒ³æ³•æ˜¯ä»€ä¹ˆï¼Ÿ',
                        'æˆ‘è¯¥å¦‚ä½•è¡¨è¾¾ï¼Ÿ',
                        'è¿™æ®µå…³ç³»çš„è½¬æœºåœ¨å“ªé‡Œï¼Ÿ'
                    ];
                } else if (questionLower.includes('è´¢') || questionLower.includes('é’±') || questionLower.includes('æŠ•èµ„')) {
                    suggestions = [
                        'å¦‚ä½•å¢åŠ æ”¶å…¥ï¼Ÿ',
                        'æŠ•èµ„æ–¹å‘æ˜¯ä»€ä¹ˆï¼Ÿ',
                        'éœ€è¦é¿å…ä»€ä¹ˆé£é™©ï¼Ÿ',
                        'è´¢è¿ä½•æ—¶è½¬å¥½ï¼Ÿ'
                    ];
                } else if (questionLower.includes('åˆ›ä¸š') || questionLower.includes('é¡¹ç›®')) {
                    suggestions = [
                        'å¦‚ä½•æ‰¾åˆ°åˆé€‚çš„åˆä½œä¼™ä¼´ï¼Ÿ',
                        'èµ„é‡‘é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ',
                        'å¸‚åœºå‰æ™¯å¦‚ä½•ï¼Ÿ',
                        'éœ€è¦æ³¨æ„å“ªäº›ç»†èŠ‚ï¼Ÿ'
                    ];
                }

                return suggestions;
            }

            async handleFollowupQuestion() {
                console.log('ğŸ¤– å¼€å§‹å¤„ç†æ˜“ç»è¿½é—®...');

                // æ£€æŸ¥æ˜¯å¦æœ‰å åœç»“æœ
                if (!currentIChing || !currentIChing.hexagramNumber) {
                    alert('è¯·å…ˆè¿›è¡Œæ˜“ç»å åœå†æé—®');
                    return;
                }

                const followupInput = document.getElementById('followupInput');
                const askButton = document.getElementById('askFollowup');
                const loadingDiv = document.getElementById('followupLoading');
                const answerDiv = document.getElementById('followupAnswer');
                const answerText = document.getElementById('followupAnswerText');

                const question = followupInput.value.trim();
                console.log('ğŸ“ ç”¨æˆ·è¿½é—®:', question);

                if (!question) {
                    alert('è¯·è¾“å…¥æ‚¨çš„è¿½é—®');
                    return;
                }

                // æ£€æŸ¥ç”¨æˆ·æƒé™
                if (typeof window !== 'undefined' && window.subscriptionManager) {
                    const access = window.subscriptionManager.canUseService('iching');

                    if (!access.allowed) {
                        console.log('éœ€è¦å‡çº§æˆ–æŒ‰æ¬¡ä»˜è´¹æ‰èƒ½ä½¿ç”¨AIè¿½é—®åŠŸèƒ½');
                        window.subscriptionManager.showUpgradePrompt('AIæ˜“ç»è¿½é—®', 'iching');
                        return;
                    }
                }

                // Show loading
                if (loadingDiv) loadingDiv.classList.remove('hidden');
                if (answerDiv) answerDiv.classList.add('hidden');
                if (askButton) askButton.disabled = true;

                try {
                    // Call AI service with optimized prompts
                    if (window.aiService) {
                        // Get current language
                        const lang = localStorage.getItem('preferredLanguage') || 'zh';

                        // Get hexagram data
                        const hexData = this.getHexagramData();
                        const hexagramNumber = hexData.number;
                        const hexagramName = window.ichingAI?.hexagrams[hexagramNumber]?.chinese || 'æœªçŸ¥';

                        // Get changing lines
                        const changingLines = this.hexagramLines
                            .map((line, index) => line.changing ? (index + 1) : null)
                            .filter(n => n !== null);

                        // Get optimized system prompt from CONFIG
                        const systemPrompt = window.CONFIG?.PROMPTS?.ICHING?.FOLLOWUP_SYSTEM?.(lang) ||
                            (lang === 'en' ?
                                'You are a professional I Ching master.' :
                                'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ˜“ç»å¤§å¸ˆã€‚');

                        // Build user prompt with complete context
                        const userPrompt = this.buildFollowupUserPrompt(
                            this.question,
                            hexagramNumber,
                            hexagramName,
                            changingLines,
                            question,
                            lang
                        );

                        const result = await window.aiService.sendRequest(systemPrompt, userPrompt, {
                            type: 'iching-followup',
                            temperature: 0.8,
                            maxTokens: 2000
                        });

                        // Display answer with formatting
                        if (answerText) {
                            const formattedAnswer = this.formatFollowupAnswer(
                                typeof result === 'string' ? result : result.answer || 'æ— æ³•è·å–å›ç­”',
                                lang
                            );
                            answerText.innerHTML = formattedAnswer;
                        }
                        if (answerDiv) answerDiv.classList.remove('hidden');

                    } else {
                        throw new Error('AIæœåŠ¡æœªåŠ è½½');
                    }
                } catch (error) {
                    console.error('Follow-up question error:', error);
                    if (answerText) {
                        answerText.textContent = 'æŠ±æ­‰ï¼ŒAIæš‚æ—¶æ— æ³•å›ç­”ã€‚è¯·ç¨åå†è¯•ã€‚';
                    }
                    if (answerDiv) answerDiv.classList.remove('hidden');
                } finally {
                    // Hide loading
                    if (loadingDiv) loadingDiv.classList.add('hidden');
                    if (askButton) askButton.disabled = false;
                }
            }

            buildFollowupUserPrompt(originalQuestion, hexagramNumber, hexagramName, changingLines, followupQuestion, lang) {
                const isEnglish = lang === 'en';

                if (isEnglish) {
                    return `Please provide deep I Ching analysis and answer the user's follow-up question based on the following divination results.

**Task**: Based on the hexagram information below, conduct deep I Ching analysis and provide practical life guidance.

**Input Data (Divination Information)**:
- Original Question: ${originalQuestion}
- Hexagram Number: ${hexagramNumber}
- Hexagram Name: ${hexagramName}
- Changing Lines: ${changingLines.length > 0 ? changingLines.join(', ') : 'None'}

**User's Follow-up Question (Seeking Deeper Truth)**:
${followupQuestion}

**Analysis Framework & Output Requirements**:

Please output the analysis following these steps, combining classical I Ching wisdom with modern practicality:

**Part 1: Hexagram Structure & Symbolic Analysis**
- Analyze the hexagram's upper and lower trigrams (e.g., Heaven above, Earth below)
- Explain the Five Elements attributes and their mutual generation/restraint relationships
- Interpret the hexagram name's etymology and symbolic meanings
- **Requirement**: Must cite original texts from "Zhou Yi Ben Yi" or "Yi Zhuan" to support your analysis

**Part 2: Judgment & Image Text Interpretation**
- Cite the original hexagram judgment text
- Provide vernacular interpretation of the judgment
- Cite the image text (Da Xiang)
- Explain how the judgment and image relate to the user's question

**Part 3: Changing Lines Analysis & Transformation** (if applicable)
- Analyze the meaning of each changing line
- Explain the transformation from original hexagram to future hexagram
- Reveal the development trend of the situation
- Provide timing analysis (when changes will occur)

**Part 4: Situational Assessment & Timing Analysis**
- Assess current situation: favorable/unfavorable, timing, momentum
- Provide timing analysis:
  * When to act (optimal action window)
  * When to wait (patience required periods)
  * When to retreat (strategic withdrawal timing)

**Part 5: Action Guidance & Decision Suggestions**
- Provide specific, actionable advice (what to do, what to avoid)
- Combine I Ching wisdom with modern decision science
- Include:
  * Immediate actions (within 1 week)
  * Short-term strategies (1-3 months)
  * Long-term planning (3-12 months)

**Part 6: Psychological Insight & Mindset Adjustment**
- Analyze the user's psychological state based on the question
- Provide mindset adjustment suggestions
- Combine Jungian synchronicity theory
- Help users face situations with a calm, wise mind

**Constraints**:
- For complex I Ching terminology, must provide easy-to-understand explanations
- Use Markdown formatting, bold key points
- Provide specific, actionable advice, not vague generalizations
- Maintain an objective, neutral, and wise tone
- Cite original texts to support judgments

**IMPORTANT: Please respond in ENGLISH. All text must be in English. Use wise yet accessible language.**`;
                }

                return `è¯·æ ¹æ®ä»¥ä¸‹å åœç»“æœæä¾›æ·±åº¦æ˜“ç»åˆ†æï¼Œå¹¶å›ç­”ç”¨æˆ·çš„è¿½é—®ã€‚

**Taskï¼ˆä»»åŠ¡ï¼‰**ï¼šæ ¹æ®ä¸‹æ–¹çš„å¦è±¡ä¿¡æ¯ï¼Œè¿›è¡Œæ·±åº¦æ˜“ç»åˆ†æï¼Œå¹¶æä¾›å®ç”¨çš„äººç”ŸæŒ‡å¯¼ã€‚

**Input Dataï¼ˆå åœä¿¡æ¯ï¼‰**ï¼š
- åŸå§‹é—®é¢˜ï¼š${originalQuestion}
- å¦è±¡ç¼–å·ï¼š${hexagramNumber}
- å¦è±¡åç§°ï¼š${hexagramName}
- å˜çˆ»ï¼š${changingLines.length > 0 ? changingLines.join('ã€') : 'æ— '}

**ç”¨æˆ·çš„è¿½é—®ï¼ˆå¯»æ±‚æ·±æŒ–çœŸç›¸ï¼‰**ï¼š
${followupQuestion}

**Analysis Frameworkï¼ˆåˆ†ææ¡†æ¶&è¾“å‡ºè¦æ±‚ï¼‰**ï¼š

è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è¾“å‡ºåˆ†æï¼Œç»“åˆæ˜“ç»ç»å…¸æ™ºæ…§ä¸ç°ä»£å®ç”¨æ€§ï¼š

**ç¬¬ä¸€éƒ¨åˆ†ï¼šå¦è±¡ç»“æ„ä¸è±¡å¾åˆ†æ**
- åˆ†æå¦è±¡çš„ä¸Šä¸‹å¦ï¼ˆå¦‚ï¼šä¸Šä¹¾ä¸‹å¤ï¼‰
- è§£é‡Šäº”è¡Œå±æ€§å’Œç›¸ç”Ÿç›¸å…‹å…³ç³»
- é˜é‡Šå¦åçš„ç”±æ¥å’Œè±¡å¾æ„ä¹‰
- **è¦æ±‚**ï¼šå¿…é¡»å¼•ç”¨ã€Šå‘¨æ˜“æœ¬ä¹‰ã€‹æˆ–ã€Šæ˜“ä¼ ã€‹åŸæ–‡æ¥ä½è¯ä½ çš„åˆ†æ

**ç¬¬äºŒéƒ¨åˆ†ï¼šå¦è¾ä¸è±¡è¾è§£è¯»**
- å¼•ç”¨åŸæ–‡å¦è¾
- ç”¨ç™½è¯æ–‡è§£é‡Šå¦è¾å«ä¹‰
- å¼•ç”¨è±¡è¾ï¼ˆå¤§è±¡ï¼‰
- è¯´æ˜å¦è¾å’Œè±¡è¾å¦‚ä½•å…³è”ç”¨æˆ·çš„é—®é¢˜

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šå˜çˆ»åˆ†æä¸è½¬åŒ–**ï¼ˆå¦‚æœ‰å˜çˆ»ï¼‰
- åˆ†ææ¯ä¸ªå˜çˆ»çš„å«ä¹‰
- è§£é‡Šæœ¬å¦åˆ°ä¹‹å¦çš„è½¬åŒ–
- æ­ç¤ºäº‹æ€å‘å±•è¶‹åŠ¿
- æä¾›æ—¶æœºåˆ†æï¼ˆä½•æ—¶ä¼šå‘ç”Ÿå˜åŒ–ï¼‰

**ç¬¬å››éƒ¨åˆ†ï¼šå½¢åŠ¿åˆ¤æ–­ä¸æ—¶æœºåˆ†æ**
- åˆ¤æ–­å½“å‰å½¢åŠ¿ï¼šå‰å‡¶ã€æ—¶æœºã€åŠ¿æ€
- æä¾›æ—¶æœºåˆ†æï¼š
  * ä½•æ—¶è¡ŒåŠ¨ï¼ˆæœ€ä½³è¡ŒåŠ¨çª—å£ï¼‰
  * ä½•æ—¶ç­‰å¾…ï¼ˆéœ€è¦è€å¿ƒçš„æ—¶æœŸï¼‰
  * ä½•æ—¶é€€å®ˆï¼ˆæˆ˜ç•¥æ€§æ’¤é€€æ—¶æœºï¼‰

**ç¬¬äº”éƒ¨åˆ†ï¼šè¡ŒåŠ¨æŒ‡å¯¼ä¸å†³ç­–å»ºè®®**
- æä¾›å…·ä½“å¯è¡Œçš„å»ºè®®ï¼ˆåº”è¯¥åšä»€ä¹ˆã€é¿å…ä»€ä¹ˆï¼‰
- ç»“åˆæ˜“ç»æ™ºæ…§å’Œç°ä»£å†³ç­–ç§‘å­¦
- åŒ…æ‹¬ï¼š
  * å³åˆ»è¡ŒåŠ¨ï¼ˆ1å‘¨å†…ï¼‰
  * çŸ­æœŸç­–ç•¥ï¼ˆ1-3ä¸ªæœˆï¼‰
  * é•¿æœŸè§„åˆ’ï¼ˆ3-12ä¸ªæœˆï¼‰

**ç¬¬å…­éƒ¨åˆ†ï¼šå¿ƒç†æ´å¯Ÿä¸å¿ƒæ€è°ƒæ•´**
- æ ¹æ®é—®é¢˜åˆ†æç”¨æˆ·çš„å¿ƒç†çŠ¶æ€
- æä¾›å¿ƒæ€è°ƒæ•´å»ºè®®
- ç»“åˆè£æ ¼çš„åŒæ­¥æ€§ç†è®º
- å¸®åŠ©ç”¨æˆ·ä»¥å¹³å’Œã€æ™ºæ…§çš„å¿ƒæ€é¢å¯¹å±€åŠ¿

**Constraintsï¼ˆçº¦æŸï¼‰**ï¼š
- å¯¹äºå¤æ‚çš„æ˜“ç»æœ¯è¯­ï¼Œå¿…é¡»æä¾›é€šä¿—æ˜“æ‡‚çš„è§£é‡Š
- ä½¿ç”¨Markdownæ’ç‰ˆï¼Œé‡ç‚¹å†…å®¹è¯·åŠ ç²—
- æä¾›å…·ä½“å¯è¡Œçš„å»ºè®®ï¼Œä¸è¦æ³›æ³›è€Œè°ˆ
- ä¿æŒå®¢è§‚ã€ä¸­ç«‹ã€æ™ºæ…§çš„è¯­æ°”
- å¼•ç”¨åŸæ–‡ä½è¯åˆ¤æ–­

**é‡è¦ï¼šè¯·ç”¨ä¸­æ–‡å›å¤ã€‚æ‰€æœ‰æ–‡æœ¬å¿…é¡»æ˜¯ä¸­æ–‡ã€‚ä½¿ç”¨æ™ºæ…§ä½†æ˜“æ‡‚çš„è¯­è¨€ã€‚**`;
            }

            formatFollowupAnswer(answer, lang) {
                // Convert newlines to HTML
                let formatted = answer.replace(/\n/g, '<br>');

                // Highlight keywords based on language
                const keywords = lang === 'en' ? [
                    'Hexagram', 'Judgment', 'Image', 'Changing Line', 'Transformation',
                    'Favorable', 'Unfavorable', 'Timing', 'Action', 'Wait', 'Retreat',
                    'Advice', 'Suggestion', 'Caution', 'Opportunity', 'Challenge',
                    'Heaven', 'Earth', 'Thunder', 'Wind', 'Water', 'Fire', 'Mountain', 'Lake',
                    'Important', 'Key', 'Essential', 'Critical'
                ] : [
                    'å¦è±¡', 'å¦è¾', 'è±¡è¾', 'å˜çˆ»', 'è½¬åŒ–', 'ä¹‹å¦',
                    'å‰', 'å‡¶', 'æ—¶æœº', 'è¡ŒåŠ¨', 'ç­‰å¾…', 'é€€å®ˆ',
                    'å»ºè®®', 'æ³¨æ„', 'æœºä¼š', 'æŒ‘æˆ˜', 'é£é™©',
                    'ä¹¾', 'å¤', 'éœ‡', 'å·½', 'å', 'ç¦»', 'è‰®', 'å…‘',
                    'å¤©', 'åœ°', 'é›·', 'é£', 'æ°´', 'ç«', 'å±±', 'æ³½',
                    'é‡è¦', 'å…³é”®', 'å¿…é¡»', 'åº”è¯¥', 'é¿å…'
                ];

                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'gi');
                    formatted = formatted.replace(regex, '<span class="text-mystic-gold font-semibold">$1</span>');
                });

                // Format lists
                formatted = formatted.replace(/(\d+)\.\s/g, '<br><strong class="text-mystic-gold">$1.</strong> ');

                return formatted;
            }

            displayStructure(number) {
                // Display final hexagram lines
                const finalHexagram = document.getElementById('finalHexagram');
                finalHexagram.innerHTML = '';
                this.hexagramLines.forEach(line => {
                    const lineElement = document.createElement('div');
                    lineElement.className = `hexagram-line ${line.type}`;
                    if (line.changing) lineElement.classList.add('changing');
                    finalHexagram.appendChild(lineElement);
                });

                // Set temporary title
                document.getElementById('hexagramTitle').textContent = `Hexagram ${number}`;
                document.getElementById('hexagramDescription').textContent = '...';
            }

            displayFinalResults() {
                // Display final hexagram
                const finalHexagram = document.getElementById('finalHexagram');
                finalHexagram.innerHTML = '';

                this.hexagramLines.forEach(line => {
                    const lineElement = document.createElement('div');
                    lineElement.className = `hexagram-line ${line.type}`;

                    if (line.changing) {
                        lineElement.classList.add('changing');
                    }

                    finalHexagram.appendChild(lineElement);
                });

                // Display changing lines
                const changingLinesContainer = document.getElementById('changingLines');
                if (this.changingLines.length > 0) {
                    // è·å–å½“å‰è¯­è¨€
                    const currentLang = localStorage.getItem('destinyai_language') || 'en';
                    const translations = {
                        'en': {
                            line: 'Line',
                            changing: 'This line is changing, indicating transformation in this aspect of your situation.',
                            noChanging: 'No changing lines - the situation is stable.'
                        },
                        'zh-CN': {
                            line: 'ç¬¬',
                            changing: 'æ­¤çˆ»æ­£åœ¨å˜åŒ–ï¼Œè¡¨æ˜æ‚¨æƒ…å†µçš„è¿™ä¸€æ–¹é¢æ­£åœ¨è½¬å˜ã€‚',
                            noChanging: 'æ— å˜çˆ» - æƒ…å†µç¨³å®šã€‚'
                        },
                        'zh-TW': {
                            line: 'ç¬¬',
                            changing: 'æ­¤çˆ»æ­£åœ¨è®ŠåŒ–ï¼Œè¡¨æ˜æ‚¨æƒ…æ³çš„é€™ä¸€æ–¹é¢æ­£åœ¨è½‰è®Šã€‚',
                            noChanging: 'ç„¡è®Šçˆ» - æƒ…æ³ç©©å®šã€‚'
                        }
                    };

                    const t = translations[currentLang] || translations['en'];

                    changingLinesContainer.innerHTML = this.changingLines.map(lineNum =>
                        `<div class="bg-white/10 rounded-lg p-3">
                            <span class="text-mystic-gold font-semibold">${t.line} ${lineNum} çˆ»</span>
                            <p class="text-sm text-moon-silver mt-1">${t.changing}</p>
                        </div>`
                    ).join('');
                } else {
                    const currentLang = localStorage.getItem('destinyai_language') || 'en';
                    const noChangingText = {
                        'en': 'No changing lines - the situation is stable.',
                        'zh-CN': 'æ— å˜çˆ» - æƒ…å†µç¨³å®šã€‚',
                        'zh-TW': 'ç„¡è®Šçˆ» - æƒ…æ³ç©©å®šã€‚'
                    };
                    changingLinesContainer.innerHTML = `<p class="text-moon-silver">${noChangingText[currentLang] || noChangingText['en']}</p>`;
                }

                // Update hexagram information
                const hexagramName = this.getHexagramName();
                document.getElementById('hexagramTitle').textContent = hexagramName;

                // Generate personalized interpretation based on question
                this.generatePersonalizedInterpretation();
            }

            generatePersonalizedInterpretation() {
                const interpretations = {
                    judgment: [
                        "The creative principle manifests through persistent action and strong will. This is a time for leadership and initiative.",
                        "The receptive earth energy suggests patience and nurturing. Allow things to develop naturally.",
                        "Difficulty at the beginning is natural. Persevere through initial challenges with determination.",
                        "Youthful folly requires guidance and learning. Remain humble and seek wisdom from others.",
                        "Waiting with patience and preparation will lead to success. Use this time wisely.",
                        "Conflict requires careful navigation. Seek resolution through diplomacy rather than force."
                    ],
                    image: [
                        "The movement of heaven is powerful and constant. Strengthen yourself through persistent effort.",
                        "The earth carries all things with devotion. Be supportive and nurturing in your relationships.",
                        "Clouds and thunder bring difficulty. Prepare for challenges and remain adaptable.",
                        "Spring water flows gently. Approach learning with humility and openness.",
                        "Heaven above water creates waiting. Maintain faith while preparing for opportunities.",
                        "Heaven and water move in opposite directions. Seek harmony in conflicting situations."
                    ],
                    advice: [
                        "Trust your creative instincts and act decisively. Your natural talents will guide you to success.",
                        "Practice patience and allow situations to develop naturally. Forcing outcomes may backfire.",
                        "Embrace challenges as learning opportunities. Each obstacle strengthens your character.",
                        "Remain humble and open to guidance. Wisdom comes from acknowledging what you don't know.",
                        "Use waiting periods productively. Preparation meets opportunity when the time is right.",
                        "Navigate conflicts with diplomacy. Understanding different perspectives leads to resolution."
                    ]
                };

                // Select random interpretations
                const randomIndex = Math.floor(Math.random() * interpretations.judgment.length);

                document.getElementById('judgmentText').textContent = interpretations.judgment[randomIndex];
                document.getElementById('imageText').textContent = interpretations.image[randomIndex];
                document.getElementById('adviceText').textContent = interpretations.advice[randomIndex];
            }

            saveReading() {
                const reading = {
                    timestamp: new Date().toISOString(),
                    method: this.selectedMethod,
                    question: this.question,
                    hexagram: this.hexagramLines,
                    changingLines: this.changingLines
                };

                const savedReadings = JSON.parse(localStorage.getItem('ichingReadings') || '[]');
                savedReadings.push(reading);
                localStorage.setItem('ichingReadings', JSON.stringify(savedReadings));

                alert('Reading saved successfully!');
            }

            shareReading() {
                if (navigator.share) {
                    navigator.share({
                        title: 'My I-Ching Reading',
                        text: 'Check out my I-Ching divination from Destiny AI!',
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        alert('Link copied to clipboard!');
                    });
                }
            }

            newDivination() {
                // Reset everything
                this.selectedMethod = null;
                this.currentCast = 0;
                this.hexagramLines = [];
                this.changingLines = [];
                this.question = '';

                // Hide results and coin sections
                document.getElementById('resultsSection').classList.add('hidden');
                document.getElementById('coinSection').classList.add('hidden');

                // Show method section
                document.getElementById('methodSection').classList.remove('hidden');

                // Reset form
                document.getElementById('questionInput').value = '';
                document.querySelectorAll('.method-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }
        }

        // Initialize I-Ching functionality when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new IChingDivination();
        });
    </script>

    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="supabase-init.js"></script>

    <!-- è®¤è¯ç³»ç»Ÿ - é¡µé¢è®¿é—®æ§åˆ¶ -->
    <script src="auth-service.js"></script>
    <script src="auth-guard-enhanced.js"></script>

    <!-- ç”¨æˆ·èœå• -->
    <script src="user-menu.js"></script>

    <!-- AI Service -->
    <script src="ai-service.js"></script>

    <!-- I-Ching æ·±æŒ–çœŸç›¸åŠŸèƒ½ -->
    <script src="iching-followup.js"></script>

    <!-- å¯¼å‡ºåŠŸèƒ½äº‹ä»¶ç›‘å¬å™¨ -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // PDF å¯¼å‡º
            const exportPDFBtn = document.getElementById('exportPDF');
            if (exportPDFBtn) {
                exportPDFBtn.addEventListener('click', function () {
                    const filename = `æ˜“ç»å¦è±¡åˆ†æ_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.pdf`;
                    exportToPDF('resultsSection', filename);
                });
            }

            // HTML ä¿å­˜
            const exportHTMLBtn = document.getElementById('exportHTML');
            if (exportHTMLBtn) {
                exportHTMLBtn.addEventListener('click', function () {
                    const filename = `æ˜“ç»å¦è±¡åˆ†æ_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.html`;
                    saveAsHTML('resultsSection', filename);
                });
            }

            // é‡æ–°æ’ç›˜
            const resetBtn = document.getElementById('resetReading');
            if (resetBtn) {
                resetBtn.addEventListener('click', function () {
                    if (confirm(window.i18n ? window.i18n.t('iching.confirm_reset') : 'ç¡®å®šè¦é‡æ–°æ’ç›˜å—ï¼Ÿå½“å‰ç»“æœå°†è¢«æ¸…é™¤ã€‚')) {
                        resetIChingReading();
                    }
                });
            }
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('[SW] Registered'))
                    .catch(err => console.log('[SW] Failed', err));
            });
        }
    </script>
</body>

</html>